---
title: "DataExpert.io - Apply Analytical Patterns Lab & Lecture 1 - Data Engineering Bootcamp"
author:
  - "Jade Codes"
published: 2025-01-06
source: "https://www.youtube.com/watch?v=OZnWihgeIQk&t=1112s"
image: "https://i.ytimg.com/vi/OZnWihgeIQk/maxresdefault.jpg?sqp=-oaymwEmCIAKENAF8quKqQMa8AEB-AH-CYAC0AWKAgwIABABGCIgZShHMA8=&rs=AOn4CLDwU62Yeb_H9CgwO46hOAcz_aDalA"
created: 2025-03-23
tags:
  - "youtube"
  - "Data_Engineering_Bootcamp"
  - "Analytical_Patterns"
  - "Data_Analysis"
summary: "Data Engineering Bootcamp lecture covering analytical patterns: aggregation, cumulation, and window-based analysis. Learn to build robust data pipelines."
---
# DataExpert.io - Apply Analytical Patterns Lab & Lecture 1 - Data Engineering Bootcamp

![DataExpert.io - Apply Analytical Patterns Lab & Lecture 1 - Data Engineering Bootcamp](https://www.youtube.com/embed/OZnWihgeIQk&t=1112s)

> [!summary]- Description
> Thank you for joining me on my Data Engineering Bootcamp journey!
> 
> I'm so excited to have you here as we work through this incredible free bootcamp together. A huge shoutout to Zach for creating such an amazing resource!  
> 
> Before we dive in, let’s go over a few quick house rules:  
> 1️⃣ If you’re also following along with the bootcamp, make sure you check out the official site at:
> https://bootcamp.techcreator.io/ 
> 2️⃣ Don’t forget to watch Zach's videos directly too! He deserves the watch hours, and you deserve the credit for completing the bootcamp.  
> 
> This bootcamp is completely free, but I also want to let you know I’ll be joining Zach's paid bootcamp in January. 
> 
> If you're interested in leveling up your skills even further, you can use my link for 20% off: 
> https://www.dataexpert.io/jade
> 
> Thank you again for being here, let’s make the most of this bootcamp and learn some amazing skills together!

> [!note]- Transcript (Youtube)
> hello everyone welcome back to my live streams so excited to be back and be streaming today what I'm going to do is I'm just gonna quickly go into just a bit of a bit of promo for Zach um like I said I've not been I've not been paid to do this you know um I've signed up this course because I genuinely wanted to learn data engineering but because of that he did give me an affiliate link and because of everything I've been doing he's been giving me a affiliate link as well so if anyone is thinking of signing up before tomorrow which is the deadline here's my affiliate link if you want to but if not that's fine and yeah we'll get into the actual um the lab now so number in when as s l one thing about that as well like um is that companies that use local platforms tend to find that like they try and they end up tying in their developers they they hire to do that because the look have platforms that they end up using are very very hard to like to they're not that they're very very specific to that company a lot of the time and so it's very very hard to find a job in the same role as that so whil yes you can get a new role in like like as a product like being someone who used Toco platforms you still have to go through that training of understanding the new platform and stuff like that wherever you go and so companies really really prey on this by like locking in their their um development teams by doing that I've seen that quite a lot to do okay the sound is down can he that's fine let just again is that better frustratingly um let me just that hello hello is that unfortunately like I is that better now I'm I'm trying to do it so that like um the sounds that but I want to reduce the amount of noise from like my clicking and stuff like that so I think I might need to get like um a a a shield for my microphone because it won't it keeps like detecting the clicking and I can't reduce the gain because if I reduce the gain then you can't hear me so um that's the next thing I'm going to try and get one of those um shields for my microphone so that it doesn't like get the clicking as much so sorry about the clicking if you can hear the clicking and last we're talking about is window based analys analysis and we're going to be doing all three of these on the lab today and they should be a pretty good time uh the the queries for that stuff isn't they aren't too crazy and keeping in mind that some of these are really closely linked with the concept of cumulation you have that cumulative table design that we talked about in week one and some of these are actually based on top of cumulative table design and they don't work very well without cumulative table design so keeping keeping that in mind as we kind of go through this presentation that what I'm trying to do is teach yall the kind of layering of all this stuff and hopefully this will give you some powerful Tools in your tool belt for when you are building out your pipelines so yeah let's let's dig into this though repeatable analyses right in the last slide I was talking about how it reduces uh your cognitive load because you don't have to think about things in SQL you can think about things that kind of like bigger picture layers right because imagine like if you're the CEO of a company and you had to think about every single line of code like imagine one of my beautiful examples I like to give in this Cas is so at one point in my career I uh wrote a dashboard for Mark Zuckerberg and he liked my dashboard a lot but like had I been like nazak like you gotta you gotta write the sequel and he's not gonna write the sequel because that's not his abstraction he's like n that's too much of a cognitive load I need I don't need to care about the column names I don't need to care about any of that I just want the picture and so that's one of the things that I hope that we as data professionals can get better at is understanding the right layer of abstraction because a lot of the time I think as data Engineers we are like we live breathe and die by SQL and if it's like if you take our so this isn't just data engineering as well this is in any sort of um in any sort of like field so like in software engineering as well so like for example I recently did a demonstration and I filmed it and it was about I filmed it was about like a deaths Ops pip that like it was about a Dev to Ops pipeline that we created and and strategy that that i' created for for our customer and I didn't um I didn't realize like the main the main stakeholder at the time wasn't going to be be technical because the te the stakeholders that I've dealt with are quite Technical and so when we when I had that feedback in in the review of we need to make this less technical because of of of who the main stay called is going to be um I've had to go back and I've had to like remove a lot of things that I wasn't I would have like kept if I was just talking to the ones that I was familiar with so it's not just data engineering software engineering it's devops as well you have to know who your audience is so for example for my stakeholder I just need to show okay these are the security these are the security implications what we're protecting against um these are the things that we've done to protect against them so like you know credential um blocking credentials from being pushed uh um picking up security vulnerabilities and and showing how that like how the tools that we've got remediate against them so that was that was that was an example that isn't data engineering but it's very very similar of you need to know who your stakeholders are going to be who you're going to be talking to and give them that level of extraction that they our SQL away like some of us would feel like we are a Knight without a sword or we're a Knight without our armor or we are you know we aren't even bringing a weapon to the gunfight anymore if you take our SQL away and so that's something I want to change and that's one of the goals of this presentation is for a couple reasons because one like in the future the abstraction is going to change llms are going to change things SQL is going to be different or how we create SQL is going to be different so really the more important thing is having these higher level patterns and understanding how to apply these higher level patterns and then it's going to be a very in some ways it's going to be a very exciting time I know that in some regards some data Engineers have some fear about this where they're like oh wow if uh chat GPT can just write SQL like am I deprecated am I just going to be laid off am I not going to be around anymore and I I don't believe that I believe that if you have a firmer grasp on these higher level analytical patterns then you can be that chat GPT using engineer who can write pipelines incredibly quickly and your your value to the company will be just astronomically higher and that's what that's why the second bullet here is all about streamlining your impact because if if you had to think about like okay if I needed to like go to the store and uh and I want to make a cake and every single time I want to make a cake I like go to the store get the bat or I get like the get the flour get the egg get the sugar get all like the the raw materials and like you know Stir It Up and make the cake like that's good and that kind of makes you a baker but that's not necessarily the the best way to because sometimes maybe you're strapped on time maybe the the stakeholders are like can you just pull this cake for me real quick and you're like dude like cake cake making takes time and like if you you know if you asked for it to be pulled real quick I'm gonna burn it or whatever and that's where these patterns can help you do things where instead of maybe making everything from scratch you buy some of the pieces pre-made and then all you do is put the frosting on the top of it and then the rest of it's pre-made and ready to go so that's stuff's pretty cool about that's what that's one of my favorite Parts about repeatable analyses is once you recognize the higher level picture the pipeline writes itself it really does like you have to be careful around the edges and like being careful around like accumulative table design and like a lot of the gotas there for some of these patterns but if you got those down then I wouldn't worry too much about it because you know the higher level pattern and what the pattern looks like and yeah you'll be good from there so remember this repeatable analyses are your friend they allow you to play with bigger Legos you don't have to play with like the little tiny two-piece Legos you can play with like the bigger ones and then they can kind of Stack together and you can build a tower way faster so that's my main goal here about this is uh recognize that repeatable analyses are very powerful so I was when I was making this slide I was trying to figure out all the higher high level analyses that I've ever done in my career and it's wild because I really think that there's only three buckets here there there might be more uh uh like if you are kind of pushing the envelope and you're not in the data engineering realm and you're more in the data science realm and stuff like that there might be some other uh analytical patterns that exist but for the most part I've found there to be three you have aggregation based patterns cumulation based patterns and window based patterns and if you can Master these three patterns you are going to be a master of analytics and like 95% plus of all the pipelines that I've written in my career in big Tech they use these three patterns so if you can figure this stuff out that's going to be great like some regards you could say that there's another one called like an enrichment pattern where you like do a join and bring in other columns but but my whole point about this uh lecture is that we are already at the master data layer where we have all the columns that we need so in richment does not take place in this realm because we already have all the columns that we need so that's going to be the one that could potentially You could argue could also be in this list so let's kind of go over each one and go over the depth of each one because there's there's a lot there's a lot in each one of these buckets so I I really hope to uh illustrate to y'all how to really build on these aggregation BAS patterns so aggregation based patterns are probably the simplest patterns so when you're building out a pipeline and you do an aggregation there's a a certain keyword a SQL keyword that be that should be screaming at you when you say aggregation there's one keyword that should come up and that's Group by so you have group by aggregations are all about grouping by uh different things and Counting Things based on different dimensions I remember uh when I was working at Facebook they uh back in the day like when I was there 2016 one of the tenants of the company was move fast and break things which for me I loved I found that to be so amazing and after like six months into working there they were like no more no more move fast and break things we're done and then they tried to change it and then for like the software Engineers they changed it to move fast and build things and then for the analytics people they moved it to they changed it to move fast and count things and so like I don't know like I was always sad about that but my main point with that whole story is counting is a a very important part of analytics and it it gets it doesn't get enough credit it honestly does not get enough credit because it's not sexy it's not fancy it's just it's it's like I don't know it's like the meat and potatoes of analytics like you know saying oh we have seven million users in India and we have five million users in the US or da D like and it's just like we have this stuff or like a line chart of growth and being able to see like oh this is our line chart and you can you could do really cool stuff with with line charts even as well and you can be able to combine them and look at all sorts of different things and so when you're doing an aggregation and an aggregation based analysis you're going to have some you're G to have some aggregation functions like usually like sum or average or count usually so this is what I really love about just like data engineering software engineer and anything in in general like this like it can be something so simple as just counting and you've got someone who super out here who thinks oh my God this is really cool and it you know it is it's it's it's simple Concepts that create such high value in companies so I I think that's really cool that's usually it some average count that's that's about it like that's what you're going to be using for this like maybe maybe uh more funky stuff like array a and other things but like but we're already at the analytics phase so at this point you're going to mostly be summing averaging and Counting things that's like uh in our last class I guess there was one more there was the percentile percentile can be an interesting one but percentile and average are like the same thing right percentile is just uh or average is just a specific case of percentile where percent average is just 50th percentile so those two functions are technically the same thing they just have like it's just like where in the distribution you pick and so I don't know it's uh it's some pretty good stuff so uh but I no that's median my bad median median and percentile are the same those are the same not average average is different average is because average could be skewed made a mistake but median is another one that you could potentially use in these cases but one one of the main things I'm trying to say here with aggregation based analyses is you're going to group on things and you're going to count things and you're usually going to bring in some Dimensions uh in this case you might have like country or gender or device or I don't know all sorts of different dimensions and those Dimensions can be really powerful uh to see what's going on and for example another thing I worked on at Facebook was this thing called the root cause analysis of framework where what it did was you could plug in any metric and it would explain the movement of that metric so say for example you had a week over week change and the week over we change of the metric was like plus a million and then what it would do is it would give you the the dimensional breakdown of that of like oh it's plus a million but it's actually like plus 1.5 million in the US and minus 500k in India and it would give you the actual because just because a the total grand total of a metric is positive or like it moves in One Direction doesn't mean that all the dimensional Cuts within it are moving in that same direction it's just that like in total they all add up to that together so one of the things that you can do with root cause analysis is if you see kind of a certain shift in a metric that you can start bringing in other dimensions to see like oh is it because of gender is it because of country is it because of um device operating system is it because of height or whatever whatever or age or there's all sorts of different dimensions that you could bring in to try to diagnose a shift in a metric and that is one of the things that I think is one of the most important parts of being a data analyst is being able to do that is being able to like say like okay we have a line chart here we see a dip and the reason for that dip is X an example I have is like remember when I was early in my career at Facebook I uh was working on growth and then there was a massive dip in growth and they did the root cause analysis and it was because Ethiopia shut off the internet and so there was like no users in Ethiopia so and since there's no users in Ethiopia that's a kind of a big problem and so that's kind of the idea behind root cause analysis is you really are trying to do kind of the slice and dice and the storytelling uh that gives a better picture besides like number go down sad it's not that it's number go down sad and we have these people to blame or we have this product to blame and like it makes it so you can point a finger when number go down and so that you can actually blame your sadness on something not just like oh no the numbers down like I'm freaking out man and so that's like one of the things that I think is very important uh when doing root house analysis is it gives you a lot firmer picture of what's going on with your metrics so yeah uh let's let's let's go on to the next slide okay so remember what I say before uh you have um it's the most common type of analysis like just straight up it's the most common by far it's at least half maybe more of of your analyses are going to be aggregation based analyses so and keeping in mind that those other two that cumulation and window based analyses that I talked about uh in the earlier slides they can then be moved they can also have an aggregation based analysis on top of their own outputs so that's where this is always just really really powerful and you know Group by always always have group VI um so another big thing um uh about this is you have uh trends that we were talking about and then we have uh root cause analysis I was talking about in the last slide about like why why things are happening you can also have composition of like to know okay we have this many users in the US we have this many users in China or whatever one of the things that I think is important about doing these analyses is they should be at when you're doing these aggregations you shouldn't be going back to the the fact data even though there's probably a strong urge to go to the oh sorry common word in in in are you doing fact data and because with fact data like the problem with it is fact data should be aggregated along the dimensional line usually that's going to be user it might be like in ID or device ID or like group ID or some other entity Dimension but usually it's going to be user ID and you want to have things already aggregated up because like the problem is like if you're going to do fact data and you're gonna like join in all these like spicy Dimensions as well to bring in and then you're gonna like bring all bring in all these spicy dimensions and then aggregate your fact data like that's just going to be gnarly because those Dimensions won't be like one to one because if you're at the daily grain where you have like one row per user per day per and then one user one row per user per day per metric then when you do the join it's the same number of rows right because you just do a join and just like one to one and the matching is done and then the volume is better shuffle a lot better and you're going to get way better performance if you have that kind of daily aggregation staging layer than if you you know do your aggregations at the fact layer um I'd say it depends how comfortable you are with SQL so if you're quite comfortable with SQL then it's not been it's not too bad but if you're not comfortable with SQL then you've got to really learn how to work with SQL first before you do the course uh I think as well I think some some of the more software engineering aspects of it like testing and and stuff like that if you're from a software engineering background they're quite simple but if you're not from a software engineering background then it might be might be a little bit hard so it really depends on where you at at the moment one second so always kind of think about that when you're doing this agregation BAS analyses is that you should have that other layer uh called like your daily data or your daily aggregate data that is aggregated along like a user ID for a couple reasons one of the other big reasons is that if you have that data that data is also very powerful for experimentation because then if you have okay all the data along the user ID then you can put users in group a or group b or group C or whatever tested control that you want and then it's very easy to then like add that Dimension into uh your metrics and that will show you oh uh people in group C versus people in group b there's a there's a lift or a drop in the metric and that's where like you get it's like a double whammy right you get your experimentation metrics essentially for free but you also get more efficient aggregation metrics as well for like slice and dice and moving things around so that's a big thing yeah if you're if you're comfortable in SQL then it should be fine I think um like you you might find like the py spark and the the Flink stuff is takes you a bit longer but the SQL side is like for me I found that more challenging than the other stuff personally I needed to add a for composition but I think yall know what composition is I didn't need to put like an ugly ass pie chart in this presentation for yall to get what I'm trying to say so um anyways uh that's kind of the idea behind aggregation based analyses so what about some gotas here uh there's a couple gotas that I think are important is when you're doing aggregation based analyses you and you're bringing in all these Dimensions you want to be careful to not bring in too many dimensions because uh so you know we have that daily data where it's like you have all my metrics but what if instead of that what I did instead was uh I brought in these Dimensions I brought in name I brought in city I brought in height I brought in uh profession I brought in like follower count and then I just brought in like a couple different other dimensions that could be uh like but I brought in all those at the same time and then the problem is is like once you get a certain number of dimensions in in your aggregation based analysis you just get back to you just are back to the Daily data because you enough Dimensions together will will go back to uniquely identifying a person essentially and so that's where you want to be careful because when when you if you have like one person or a small group of people in your like aggregation then I don't know does that matter it's like in those situations where it's like oh this uh this grain of data had 50% growth but it went from four to six it's like w congratulations yay right but it's like that's where when you're when you're doing these aggregation based Bales you really do want to be carefully considering like the grain that you're working with that's where there's some grains that are beautiful like I really like uh like like uh like gender is a great grain this it's like I going to cut it in two three four I know like that many it's not very many uh and then also country is a good one country is an if you want some sometimes because like some some countries are really tiny and there might be like you know for me I know that there's one person in kyran who follows me on substack and so uh if that person leaves then I'll see a 100% drop in my metric and I'll be sad and but it's like you gotta be thinking about that as well that's why like when you are doing this stuff and you're looking at at especially percentage base metrics make sure you're looking at the actual counts as well because it's like oh it's 100% drop but it's the goes from one to zero and it's like okay that's not a big deal then it's like one person so that's that's a big one um another big thing to look at here is when you're doing a long time frame uh this is something I T about a bit in week two when I was talking about like that long-term analysis framework I built at Facebook is you don't want to have too many Cuts in your data when you're looking at a long time frame because time is also a dimension that's kind of like country where it's like uh kind of high cardinality because if you are looking at that kind of stuff then you want to be careful and that's where you can kind of if you want to do these analyses on a longer time frame uh you can lower the cardinality of it and just don't look at it per day but maybe look at it per week or per month or even per year where then you like aggregate all the data across an entire year as opposed to like still holding on to the the daily grain because if you hold on to the Daily grain and you're doing some sort of long-term analysis like you're just going to get a lot of rows a lot of rows of data especially if you then choose other dimensions that also are high card anality then you're gonna get really a lot of rows even like just country and day is gonna give you a lot because if you think about like if you have 90 days and then you have country then that's like okay um that's going to be 90 time 200 let's not about 1,00 rows for 90 days right but then if you had any other like other high higher cardinality Dimensions good luck right because then you have 1800 times whatever other dimensions you also want to cut by so that's what I'm saying is that like the combination stuff really does make a big difference so I'm so like silly sometimes and just like thinking why does he sound like really really hyper but it's just because I've turned the speed up yeah aggregation based analysis pretty good uh pretty straightforward I hope uh that stuff is important and uh my whole my whole point here is just trying to give you a perspective out kind of a higher level of not like oh I need to solve this specific group by query because I'm sure most of y'all in this call have done this exact set of stuff before but haven't maybe thought about things a more abstract layer like what I'm talking about now okay so now we're going to switch gears here uh to accumulation based patterns for cumulation based patterns we're going to talk about two big ones we're going to talk about State transition tracking and then we're also going to talk about retention and uh J curves it's called retention it's called J curves it's also called survivorship analysis there's a bunch of different things I'm G have a table that shows all the different like things that you can do with that one uh and then State transition tracking has some other names as well so yeah let's kind of dive into this so these patterns are going to all be based on that cumulative table design that we worked on in week one and so if you have a firm grasp of that fundamental these analytical patterns can be built on top and I think you'll be very happy to see how this works okay so for cumulation based patterns uh one of the big things that is different about them versus uh aggregation based patterns is that they care a lot about the relationship between today and yesterday and the shift of State between today and yesterday and so those things can make a big difference where it's like okay are you active today versus yesterday or not and kind of how you shift and change and do that kind of like slowly Dimension kind of uh as you walk through your life and so that can be uh like that's like probably the biggest thing that you are going to be looking at when like or the biggest difference between like a simple aggregation based uh pattern versus accumulation based pattern and remember full hour join here your best friend it's going to be so good because the big reason why you need full outer join for these patterns is because you need to keep track of when there isn't data that's the other big thing that's different between this pattern and the aggregation based pattern is that no data is data and like it's like that's the like that's one of the things that like aggregation based patterns don't care about like if there's no data you just ignore it and it doesn't matter but in cumulation based patterns no data is data because the fact that they didn't do something means that we want to keep track of that the existence of data is something else that we want to keep track of so that's a big thing as we kind of go through this I think that will make more sense as this presentation goes on uh so I was talking in the last slide about the survival analysis and state change tracking so uh those are kind of the two big patterns that we're going to be covering in the lab today we're going to talk about growth accounting real quick this is a a special version just ignore it and it doesn't matter but in cumulation based patterns no data is data because the fact that they didn't do something means that we want to keep track of it the non-existence of data is something else that we want to keep track of so that's a big thing as we kind of go through this I got I think that will make more sense as this presentation goes on uh so I was talking in the last slide about the survival analysis and state change tracking so uh those are kind of the two big uh patterns that we're going to be covering in the lab today we're GNA talk about growth accounting real quick this is a a special version of the state transition tracking and this is where uh the cumulation part of it will make more sense so you have in this case uh there's five states a user can be in so uh the first state is New which means that yesterday they didn't exist and then now today they are active which they have to be because they signed up today so uh that's uh going to be the first state then you have um retained means that they were active yesterday they're active today pretty straightforward they just stuck around churn is active yesterday inactive today so they like left resurrected is like the opposite of churn where they were inactive yesterday and active today and then stale are the people who like they didn't come back they were not active yesterday and they're not active today so they churn out or or they are stale because they don't they don't care in some uh in in some patterns you have you have you have a sixth state of like deleted are deactivated for users who are who are like active or inactive today and then they they don't exist or they were active or inactive yesterday and then they don't exist today because they like disappeared because like you have to filter them out because sometimes in these growth accounting patterns you have to there's like policies that make it so you can't just hold on to everyone's data all the time because like that's like a privacy concern so in those cases like sometimes you can have a sixth State here which is deleted um Facebook just anonymized everything though so that we could just hold on to everything forever so and if you hold on to everything forever then there actually isn't a deleted State you just are stale you just stay stale forever and so yeah that is like I've noticed that that's one of the things that I've noticed there been a difference between this pattern like or that like how this pattern is different depending on how you apply it so one of the things I want to talk about here though is this is this pattern is actually incredibly incredibly powerful so let's kind of go over like a chart with this though because I think that will help make this pop so this is kind of like the idea behind how these charts work right so um so this is like ma monthly active users growth accounting and in this case you'll see you have churned for all the people who are leaving those big red bars and then you have new these are the new users and then you have the resurrected users and so in this case growth you could think of growth as new plus resurrected minus churn so you can see like he totally like is analyzing all of these um these things with his um de boot come and that will give you the growth rate of your business so the growth rate of how many people are coming back how many people are are uh or how many people how many incremental people you're getting because it's like the people who are coming in and the people who are leaving so you have like the the incoming and the out so one of the big things that I want to emphasize here is this is um not just specific to growth you can do this in all sorts of different areas as well because you could think of like churn resurrected new these are just different states that uh an entity can be labeled in so I want to talk about just a couple different other times so I've done growth accounting at Facebook I've used this exact pattern at Facebook uh to track like notifications growth and stuff like that to see how users are using different notifications and interacting with different notifications but like and kind of the kind of the the poster trial version of this pattern but I've also used this pattern for uh more abstract or more different things that like for example also at Facebook when I was working there I worked on tracking fake accounts so in that case you have like a new fake account which was an account that had never been labeled fake before and then they were labeled fake for the first time and then you have a a resurrected I call instead of resurrected I called it a reclassified fake account and that's where you have a fake account that like was labeled fake and then they were unlabeled fake because they passed the challenge where they like uploaded an ID or something like that they actually were like see I'm I'm a real person and then then they were classified fake again so that's like fake reclassified and then you also have like the ch state which is Declassified and in this case churn is like I mean that could be a good thing actually in Facebook that means that there's like fake accounts that are leaving right and so in that case you can see for fake accounts you have the exact same set of States as you do for growth but it's just fake not fake and like like like the history of like were they ever classified that way ever so that's another great example of like a use case for where you can use this state transition tracking so I want to go over some more that I use this this this analytical pattern so at Netflix uh I had another kind of classification algorithm because you could think of like the accounts right that's a that's an ml algorithm that's classifier right where it labels things fake not fake done right and then at Netflix there was another machine learning uh algorithm I worked with that was labeling uh applications in the in the Netflix's microservice architecture it labeled them as risky or not risky or like too risky and it was like a bunch of different states like that where it was like this is this is like critically risky versus not critically risky and then uh we wanted to track the flow of that as well because one of the things that this these types of patterns gives you is it gives you very good monitoring you can monitor the health of your machine learning models because when you are tracking stuff this closely if like the fake account model at Facebook like say they push a change and then it says like oh look at that like all these new accounts are getting re all these accounts are getting like reclassified now or there's new accounts or all these accounts are getting Declassified and that's not what we expected like this is a very very powerful uh way to model the health of your machine learning models so and I had one more I had one more time that I use this pattern this pattern has been very very very important in my career is at Airbnb uh I worked on another model that um was for hosts because I don't know if you'all have ever been on Airbnb and never had the experience where a host cancels on you and like you fly to Europe and then the host is like sorry bro we can't host you actually and they cancel last minute and that's actually one of the most painful things on Airbnb to happen and like Airbnb is really trying to prevent that so you know you have ml that classifies hosts based on the probability that they're going to do that and so that was another one that we did the same tracking of like it was like essentially it was labeling hosts as risky or not risky and then kind of seeing the health of those and trying to see like okay what are we doing and how are we because this is good for two things because on one level it's like you can look at these charts to track the health of the model you can also look at these charts to track the effectiveness of whatever you're doing like for example like on Airbnb it's like our our higher level goals of like educating hosts and teaching hosts are those things having an impact on host Behavior so that we have fewer risky hosts and so you have that kind of like higher level strategic thing that you can measure as well with this pattern so I know I just hammered home that this pattern is really important but like I've seen this pattern be very effective like everywhere I've worked in big Tech and so I and I generally think that this pattern is a very good pattern for ML Ops and like if you especially if you have a machine learning model that is a classified so if you have a classifier machine learning model that's great and that this is where you can use this a lot and that is where yeah so that's growth accounting or state trans transition accounting I love this chart we're gonna talk about survivorship analysis and bias so this chart here is in World War II there was um fighter pilots would go and fight and then they would uh they would fight fight fight and then they would fly home and then they would look at the the planes and then they're like wow uh we need to uh fix the plane and initially people were like okay and you see this chart all the red dots are the damage or like the where it got shot and like the plane experienced damage and people were like wow we need to uh we need to bolster up we need to make it so that the areas without all the the shots are stronger so that they aren't shot but then a really smart man was like but wait a minute but those are the planes that survived so actually the areas on the plane that need to be bolstered are the places with no bullet holes and that will increase our chances of survival because that will bolster the areas that can't take a hit and so in this case you see the areas on the plane here like here like kind of that midsection of the wing is where there's no shots that's really where they need a bolster because if a plane takes uh damage there they don't come back and so there's actually it's it's interesting how survivorship bias can impact you but in this case it makes sense it makes a lot of sense that that's where you would want to go if you wanted to make your planes more effective and like that's one of the things that I found interesting about a lot of different things like in my career and in other places right where it's like I think like in content creation that's a big one where it's like people like they like content creators like they will go on their journey and then like make it big and then they uh they're like wow just just do what I did and you'll be successful and a lot of people think have a lot of false hop sometimes because they see the only people they see are the stars they only see the people who won because you don't really necessarily see the people who tried and failed because they are kind of more invisible and so you want to be careful survivorship bias can really have a gnarly impact on your uh view of the world and a view on like what's considered fair or what's considered normal or all those kind of things and that was a massive tangent for this presentation but my whole point with this is it's it's true though because like you know I know for exact um uh I know for exact for example like I I've had a few people ask me like you know what did you do like to grow your LinkedIn and stuff like that it's really hard to say like if you do the exact same thing as me you're going to get the same results because that's not the case because one of the things is that you're personality does impact things a lot and the way that you are impact things a lot and the way that you um write things and the way that you think impacts things a lot so you can't just give someone a stepbystep guide of do this thing and get this results and not only that like what like things outside of your control impacts things as well so like how other people respond to you and how the market is at the time and and how everything is is around you in affects your situation you know where you work what you do um your gender your you all these things impact how people respond to you survivorship and like how long things survive is another important measurement that we need to have in our analytical patterns so let's talk a little bit deeper about this okay so if you think about retention retention in some respects is just Survivor surv surviving so you can see how there's essentially three ways that things can go uh and you see at the top here how everything starts at 100% because there's the the fundamental component of this analysis is what's considered a cohort or a reference date so it's a date that like everyone is on the same page a lot of times for growth that's like the sign up date for a user and then as time progresses the state will change because some users will stick around and some users are going to leave and so generally speaking if you have an app that has that Gray Line your app is kind of doomed because it's like as you get new users like over time they're just going to go away forever and you don't have that kind of like stickiness that an app needs to like survive you need that like crowd of people that just keeps coming back and keeps coming back and keeps coming back so that's where like if you have either a green line or an orange line those are going to be the case where you have found a successful app because there's a certain percentage of users that are sticking around for the long term especially that green line where like people come back and then like there's a bump in retention over time where people actually uh come back and they are more engaged than they were on the day they signed up and that can be a very powerful thing to see um so J curves and the reason why they're called J curves uh is if you kind of like imagine if you flipped your laptop on its side you would see there's like a little J you can kind of see there uh that's why it's called J curves so what are kind of some applications of Jer maybe Beyond growth right there's obviously like I don't just like to talk about growth analytics because there's so many other areas where you can do J curve analysis as well so essentially J curve analysis has three points you have the curve you have the state check and then you have the reference date so in uh you can think of for users you have a user who um users who stay on the app and then you have the state check is are they active or not and then the reference date is when they signed up you can also think like cancer patients uh the state check here is that they are still alive or they're not dead and then uh in this case the reference date is going to be their diagnosis date that's where you know like how they have like the those different metrics around like five years survival and 10e survival B things because I remember like uh like like one of my relatives got diagnosed with like pancreatic cancer and that cancer is like really terrible like it's like the 5year survival rate is like like 3% or 4% or something like that it's like essentially a death sentence because the survivorship analysis is so it has that really it's like one of those gray lines right where it's like you just experience that massive massive Decline and like nobody gets out alive because it doesn't flatten out for anybody and so that could be the case other cases you have uh you can think of like the smokers Who Remain smoke free after quitting so you can kind of have maybe the opposite a more of a more positive way of going about it where you have uh that's the state check are they not smoking and then uh my favorite obviously is uh you know my when I launched this boot camp uh I I said if if y'all attend all the sessions and you do all the homework then I will write you a recommendation and there's a lot of yall who were like really cocky about that you're like I'm definitely going to Pig Zack up on that and now that you listen to me talk for like 20 hours you're like okay this is a lot more than I thought it was going to be um but then obviously there's a little J curve there as well but the thing that's interesting for me is I'm already starting to see that flatin and I the following is it necessary to post multiple times a day um I I think it's necessary I definitely have seen people who haven't posted as much um build the following as well however what I would say is if you aren't posting multiple times a day like I am you have to put a lot of um a lot of effort into high quality content so visuals um something that's going to make people reshare your post um Hooks and um hooks inviting people for conversations I'd say that minimum you want to be posting um like uh four to five times a week but but I have seen people who like who really know how to make the algorithm go insane get viral uh but I've seen that a lot less often than consistent posting so your stream helps oh thank you I'm so glad that they're helping you um I think it's hard to do this on your own isn't it it's like just having someone there to watch it with you is just so much easier to to to to go through it I've always been like that with lectures and stuff it doesn't it's not that anything to do with Zach it's just um just lectures in general I already have a pretty good idea of how many recommendations I'm G need to write but that's kind of kind of the perspective that I would uh think about like these survival analysis is like a state it's it's like a state that is prolonged throughout time that is checked versus a reference date it's a good way so for me like especially with LinkedIn for example like it doesn't take me that long to write a post usually the posts that I write take me around 10 to 20 minutes like Max like some some even just take five minutes and a lot of the time they're just like and and that's just because I've got you used to it um but like there are posts that I post that are a bit more so like my videos for example they take longer and it's annoying because they're the ones that tend to do worse in engagement so it's it's it's it's a roller coaster for sure with Le and sometimes I think that I've got it and I think that I know what I need to do and then um and then I'll I'll do the same thing again and it'll dive off a cliff so it's really hard to um it's really hard to to know other than just do what it is you enjoy about it okay so what's we have one more section here which is window-based analyses which won't take quite as long because there's not as much in here as there is in other cases but so for window based analyses you really uh are going to be the the first one here I love calling is like it's the dods and moms right it's like think like Mom and Dad or the fre as the first have day over day week over week month over month year over year uh where you're looking at I like to think of that as more like a derivative right it's like a rate of change over a period of time essentially and that that's where're using window functions is great it's so great and then you have literally the opposite as well and I love I love how like window functions do both because then you have Rolling S which is like the integral and it's like uh the the accumulation over a certain window and so you get that as well and then obviously rank as well rank is interesting but rank doesn't need to be solved with window functions you can also just use like a plain Jane like order by as well but it depends on how complicated of a rank you're trying to do so how does window based stuff work so one of the key wordss here is rolling right you're going to be looking for Rolling or week over week day over day something like that and then but for Rolling you'll see that there's a specific specific uh syntax it's literally the syntax every single time and then you just change n here so you change usually sort here is going to be just you sort by date you Partition by like I don't know user ID or you Partition by whatever um the dimensional cut maybe you Partition by country or you Partition by whatever your uh whatever you're trying to cut by right whatever the the grain is and then uh the N here is going to give you the number of rolling days and it's that easy straight up is that easy that's that's what you do and uh like that's how you get your rolling rolling sums and the cool thing about these is that like essentially they do the opposite of each other so if you do the uh derivatives like the day over day week over week month over month year over year your line chart is going to get spikier it's going to get spikier and it's going to be more uh sensitive to change especially day over day day over day is going to be really uh noisy and then uh if you do month over month it becomes less noisy and then year-over-year a little bit less noisy but year-over-year is still going to be more noisy than just the regular chart like the the count chart because that's the nature of it it's a derivative it's the rate of change of the thing because now you're relying on two data points you're relying on what it was today and what it was a year ago and one of the things that I found always so interesting when I worked at Airbnb is I worked at Airbnb in a very weird time because normally in big Tech they love year-over-year year-over-year Is Just it gives the right uh it gives the right like acceleration view for a lot of different metrics but I worked at rbb in 2021 and uh in yeah of course I can go through we've got the art of gathering um it's all right cre of confidence quite like that book that's a nice one um it's about um like how to um be how to get over like being not confident when you you're creating stuff and just generally like pushing B the boundaries of innovation creativity um and the more that we use our minds and push ourselves to be creative the more that we are creative um and then we've got keep car and kodan which is really nice if you are someone who is struggling to progress as a developer and wants to learn from listen to learn from another um developer who's been in the industry for a while um and yeah but this is a really good book for that um and then I've got Grace bab's working hard hardly working really really big fan of Grace and um she's an entrepreneur who's built like three successful businesses and um she is about like she does a lot on being productive and self care and things like that and I really love this but because it just is about basically being as efficient as possible with as little time as possible and that's something that I really strive to do um and I really strive to be a productive person and driven person and so really really recommend this book um Grace is like probably I have a few entrepreneurs in my life that I really look up to Grace is probably one of the top ones Zach's another one um and I have a few more but maybe I'll share them another day and then we've got managing humans um again I really really like this book this book really helped me understand of the developers it made me understand um how to work with other people to have empathy for them um and you know if as long as you take it on the CH you don't start like putting people in boxes it's it's a really good book to read uh but it gives you a bit of appreciation for how people are different to you and how to work with different people as well because it's not just about you it's about understanding how to work as a team so I really really love this book um bpia is more about like just understanding how to um like work with the like art breaking up the boys club in Silicon Valley this is a book um that's just talking about like what it's like being a woman Intec really um it's all right um I don't love it as much as the other books um this is about the Lin startup and it's all about just creating um a startup as as um effectively as possible um in as as lean of the way as possible again it's it's a bit of a dry read to be fair I found this is quite a dry read for for me and then last but not least seven um Seven Habits of Highly Effective People classic you know it's it's a good weed I really like it it it makes me um there's a few there's a few chapters in this that I think about when I'm working with other people you know think winwin um what's the other think think wi one is the one that I really always really stands out to me um but yeah I El this book as well so if I was going to recommend any of them let me get them back these are these are my top three uh working hard hardly working managing humans and seven habits of highly effective people and then I'd also recommend keep C and code on for anyone who's to go into development so yeah that's all my books and then I've got a lot of other books here as well just don't go um with the with the color scheme um but they're just about like scrum and um and I've got a Rust book there as well um I've got a lot about like agile and scrum and servant leadership here I've got Stuart Todds how to survive the tech industry a handbook I recommend that one um a bit the these ones are a bit dry I wouldn't recommend them they're a bit like I used to be like I've got I've got certifications for it and everything but I don't really believe in scrum anymore as as the most efficient way of doing software so I don't recommend it anymore so once I have a lot of books I have a lot of certifications I don't I don't really choose it as a as a language or as a framework to to work against I'm much more I much prefer Canan as a way of working then last but not least these are my last books got a million net books loads of net books and then I also have a reaction react native book these are all my net books most of them written by Mar price really good author you should check him out um yeah that's my last a box as well as the 40 hour work week to be fair I'm going to I'll I'll download there as an audable so I don't read books as much anymore um PR I much prefer to listen to them on Audible that's just because it's it's easier for me um it's quicker so yeah if they're un audible then definitely we'll do that 2020 Airbnb had a hard time like because of the pandemic so we actually for a while Airbnb actually changed a lot of their metrics where instead of looking at year over year they were like we're going to do year over two year so they compared uh 2021 to 2019 instead of comparing it to 2020 because if you compare 2020 it was just like we're doing great we're we're up 600% or like whatever right because it's like everything was shut down in 2020 so sometimes these these metrics can be gained like that right and that's that's why those metrics can be so uh loud and so sensitive because if there was a dip or spike a year ago or a dier spike today then you're going to see a Dipper Spike uh today right for year over year so it's essentially like you increase the volatility of the chart if you are doing day over day week over week month over month whatever right but you can also decrease the volatility of the chart with using this rolling sum and rolling averages kind when you integrate right and that's how you get a chart that kind of looks like this so I don't know if y'all have ever uh traded stocks before I used to do that a lot um and so you'll see uh this the line here is going to be the ups and downs of the stock price that is normal and then you see this blue line is actually the the 50-day moving average of the stock so and you'll see the 50-day moving average is really uh different and it's very smooth and it doesn't like it's more like a trend line than uh what the actual value of a stock is at that moment in time and the thing is is like you can have an even slower trend line right because you can have a 200 day moving average and a lot of times in stocks that's what they look at they look at the 50-day and the 200 day and when the 50 what's that one s l of not given a one um is a great combo with this cost is that what you mean it crosses above the 200 day that's called like a golden cross and that's like a signal to buy and then when the 50-day cross is below the 200 day that's considered a death Cross or like a signal to sell and so you can have like uh these charts that like or these trend lines that are based on the actual data but they kind of remove some of the the volatility or some of the you know the day-to-day fluctuations of the charts and that can be very good like that can also be a very good thing because that can help uh rce the noise and make the picture a lot clearer of like what's actually going on with this this this trend so one of the things about window based analyses that I want to be uh just just a quick side note is make sure to partition on something like I know I can kind of guess what it's about based on the title but what's it kind of really about like what's it going into if you're using big data you should probably partition on something uh because if you don't like your window is going to be so huge and then uh that's going to cause o to happen I've noticed this where like you're going to partition on some sort of dimension for the most part like unless you're just trying to do like the rolling average of like all users or something like that and it's like that can be like you're gonna need like either crank up your spark memory or something like that like just so just a quick little side note about these window based things in that big data environment that you want to be aware of congrats on getting to the end of the day one lecture if you're taking this class for credit make sure to switch to the other tab so you get credit for it excited if you check out the lab first off we're gonna be creating this ddl here so I'm just going to switch over to the other lab congrats on getting to the end of the day one lecture if you're taking this class for credit make sure to switch to the other tab so that you get credit for it ex I of you check out the lab first off uh we're going to be creating this ddl here I'll explain how this ddl like kind of works we're just gonna step through this first so um and we're actually going to be using this same table for their Survivor analysis as well and I think that will be uh very useful um you'll see here we have user grow users growth accounting and then uh we have user ID obviously then we have uh first active date so this is uh the first day that that user showed up uh this might not like this is where cumulative table design can kind of mess up where like like if you start the accumulation on the wrong day you actually don't start at the beginning of of History then you might uh end up saying a user's first active date is the wrong date and they were actually active much earlier but like you just didn't start the cumula and that's fine that's like one of those things that like essentially that uh goes away over time and then uh you have last active date is going to be the last oh right okay so like it's it's a coding book even though it's not named a coding book that's interesting last day they were active and then you have daily active State weekly active state so these are going to be our um values that are going to be uh like growth accounting remember those like churned resurrected those kind of values and then dates active and date so dates active is we're just we're keeping this around this is very similar to remember in the week two when we did the dates active stuff we're going to be doing a very similar thing in this case so can go ahead and uh run that query that's fine so what we're gonna say here what I'm gonna do is I'm just gonna try and look at the the Cod to see if he's already given that Cod oh and for anyone who um who watched me the other day and was wondering what I did to get an A on my homework I just added some logging uh I just added some logging and in my homework I added um I added some logging in here and I still plan to have a regular job and keep this on the side do you think it's a bad idea to put it on my resum I've heard that recruiters would avoid me to think I would quick to continue my side hustle um yeah possibly uh it depends how you frame it really uh if you frame it as a side hustle then they might think you know you're going to to go off and do that eventually full time um to be honest like I would I wonder about that like as well like not that I'm looking at the moment but like um but if people would be would think that about me like with all the stuff that I do outside of War because I think I'm a RIS kind of thing I yeah oh so so so this is just a bit of a tangent but like for people who are following the homework the other day um this is the only other thing I changed as well I changed um I just changed the select statement to be like this so there wasn't much changes that I needed to do tweak it to get a um those were the two things that I changed just added more logging and did that but I'm only going in here because I want to have a look at the the tables so I want to take this table here we're say with yesterday as and then in this case we're going to say uh select star from users growth accounting and then we're going to say where date is equal to and we're going to start uh like I want to just start with 2023 0228 and then so what we're going to do is we're essentially going to build uh out growth accounting for the month of March because that's when I quit my job and that's like when the the data is going to be the most interesting so have to quit my job launch the company all that kind of stuff so then uh then we have today so we want to start with March 1 and we're going to be building this off of the events table so in this case what we're going to say is we're going to say uh select from events where there's yeah want to use dat trunk here just code date trunk uh day and we have event time you want to 2023 cast this to a time stamp and then this is equal to date 2023 0301 and then in here what we want to do is we want to look at essentially user ID and then we want to have count one and this will be group by user ID and this will give us essentially all the juston e because we want to have the time want when this is like today date so we can have uh both of those so what we got to start with here is this hopefully looks very similar to some of the other C just gon to have a look at the um here is theer that's fine cumulative table designs that we were working on before and you know yesterday is gonna have no data or wait hold up I need to do a quick delete because I um my table will actually have data this real quick okay so now that's that's gone and it'll be deleted so now we have our yesterday and our today very similar to our cumulative table before you can say select star from today T um full outer join yesterday Y and then in this case we have work on on t. user idal y. user ID so that makes sense so far and so what we want to do is uh we want to do the the first thing I want to do right is the cols here of like be t. userid y. user ID um as user ID because we want to get this to match right we want we want to let me grab this guy again so we can and then I'm just going to copy and we're going to comment him out though so we can just have him for reference okay so we have user ID and then we have first active date so in this case we have two values here right so in this case we have um y. first activate and t. today date as first activate and this is uh the the order of these coalesces matters and I'm just going to uh I think you'll understand what I mean by this and so okay just gnaar this this will make this is gonna make sense here so for this first one here we have first active date so essentially how it works is if yesterday has a value great we're g to pick that if not we're gonna pick today's because that means it's a new user I people I told you but you can use what you initi used to build as a reference to Showcase your SK completely agree with that completely agree and they don't have a first active date that's earlier because they're new um otherwise we can pick whatever the from yesterday was last active date is the opposite where we say okay if they were active today then that means that's the latest date that they were active and if they're not active today if today is null then we want to pick whatever it was the the last time they were active so you see how like The Ordering of the coales here makes a big difference um then we have a daily active State okay so this is going to be a case when statement um I'm just going to uh essentially put we're going to put this as a daily active state this will and weekly active State as well active State let's going to put some case lines in here I want to finish out the rest of this stuff real quick so this dat's active I'm just going to pull from the query real quick because like that doesn't matter that much because we did that last time that's going to be I'm just going to grab both of these real quick and uh just kind of copy these from the query below from okay so this is essentially just going to build out that array of dates and then this is going to essentially give us the dates that we're looking for so now this is the this is the meat of the query that I want to go over with y'all is the these case Wednesday to so let's talk about the very first case which is going to be when uh yesterday is null and today is not null that is the easiest case so we're gonna say when y. user ID is null uh and t. user ID is not null then new uh because that means that they showed up today they were active today but they uh like and they weren't they weren't in the data set before so that one that one's that one's pretty easy so the they get more complicated as we go on here so now let's talk about uh what about if they are resurrected then in that case we need to see that their active date is more than one day uh like their last activate has to be it has to have a bigger difference than one day uh between uh today's date and their last active date so if you say like y. last active date and then in this case is going to be less than um T do in this case we're going to say today date minus interval one day so um then this is resurrected because what that means is there was a gap right uh that's going to be um or we have retained as well so let's put retained in first because I think retained uh makes more sense where we say okay if last active date is equal to today date minus one then it's retained um and then we have uh so we're getting there right we have new we have retained we have resurrected so we need a churned ched is going to be uh one and then we also have stale those are going to be the two that I think are going to be important here so churned is going to be so in that case we're going to say when t. today date is null so this is uh this one's this one's a little bit trickier because uh um we we don't have uh today date so because it's null because there's no there's no daily data for that day uh but we have and then we can say and so this is gonna be y. we're g to look at last active date and this is going to be is equal to and then there's actually y do but we have y.e so y. date is like the partition date and not the last active date so we can use this essentially instead to see like what's going on here so in this case we can say okay if today is null and uh the last active date is equal to uh the date then this is going to be uh um try to say here this is going to be a churn it's quite nice actually I quite like stuff like this um it's it's good um sorry Robert long asked how how goes the analytic Labs yeah I quite like it um I love like but I really like SQL I think it's really nice um and it makes me really happy because it's very very logical so I love I love um the SQ um what and then the only other thing that's possible is St and then let's make this a like an empty string for now so I'm gonna run this query and it's G to be like very okay oh yeah we gotta cast we gotta cast these got to cast this as text because um the the types are weird okay there we go so now we have our um we have our user ID we have our first active date we have our last active date oh we have user IDs that are null oh great uh let's actually um filter those guys out say and user ID is not null it's like weird okay there we go so you'll see okay you'll see essentially everyone here is going to be daily active like always you'll see like or the daily activ is going to be new but that's because we haven't started the cumulation yet so essentially what this means is we're saying this is the beginning of time and every user that's active on this day that's their first day and some of these users might have been active before they and so that's where like when you pick uh where you start the cumulation matters a lot and but I'm not going to do that because I don't want to do like aund or two because Tech Creator I guess my platform if we wanted to actually do this the right way we would need to run this uh starting in 2019 and I would need to run this query like a thousand times to have it be absolutely perfect but I'm not gonna do that because we have 30 minutes so we're just gonna assume that everyone who uh started on uh March 1st that they are new users even if they're not actually new so in this case we only need one more thing here right we're going to need insert into users growth accounting so one of the best things about growth accounting right is this first statement is easy it's the same that one's easy okay so let's go ahead and grab these two and I think this will also be not too crazy so for retained in this case we essentially like it's not an equal to for retained because essentially what it means is that we want to see if they were active at any point in the last seven days so in this case we essentially want to say if uh instead of equal to here we're going to say greater than or equal to and then instead of uh today date um we want this to be y. dat right because the reason why this needs to be y. date instead of today dates because they might not be active today and so we want to use uh y. date and that will be our uh comparison value and then but this is going to be minus 7 so this will give us our retain um but the good news is is uh resurrected is going to be we do use today dat for resurrected so let's actually put this one above because I think that makes more sense so for uh resurrected we have last active date and then so that means that they have to have been active or the last time they were active needs to be more than seven days ago because they needed to have churn so that means that this one's pretty straightforward right so we just say Okay their last active date was um seven days ago or more and then that means that they were resurrected and then it has this is more than seven days because this is a strictly less than right and then uh if if it wasn't then they're retained then we have uh the the ones that get a little bit more complicated here right so then we have a turn turn is going to be next right and because we have the other ones already done here so in the case of churn we're gonna want to do uh okay so we have uh when y do last active date is uh okay this is going a less than um let me think about this because hold up I have I have that one I I I this one I like this this is where like I I spent a little bit of time on this so let me let me just grab this oh yeah this is where um for that's how it's done that that makes sense so for um for turn you actually have to have uh why did that like oh there's a that's way okay so turn you actually have this to have the um the T dot today date is null because you have to have that check because they can't be active today and then the the last time they were active needs to be longer than this many days ago and then but it needs to be greater than wait a minute I think actually this is not quite right because this is Gonna Catch This is Gonna Catch stale because um it needs to be okay the last active date was more than seven days ago no it has to be equal this is actually this is an equal sign right because that means it has to be exactly seven days ago because that means that uh they're churning today and then uh then yeah that makes sense to me like because that because that means that like they were uh and then otherwise they're stale that's a this is actually an equal sign here because that's that one moment in time and so uh and then we have an Els here and we have stale so now this is our weekly active State obviously for the first run everything is new so and even and the thing that is is crazy for weekly active is that for the first um uh for the first seven days is that uh hey I am running in a postgress Docker container um so I I actually if I show you I actually was the one who I I actually was the one who added the PG admin to it so that's just a little trivia there wait a minute that's actually another thing we want to be careful about here because uh resurrected and retained here oh retained does actually have to go above or there needs to be another condition and the reason for that is because uh retain and uh oh wait no no it doesn't matter because this today date is going to be uh well yeah it actually doesn't matter never mind I I I was I thought my my date logic there was a little bit off and the conditions needed to be cascaded away no but this fine so those actually do not overlap so I'm pretty sure this is going to work so essentially you see how like you have like this kind of crazy like date math that you need to do um uh this is actually not the way that they do it at Facebook they actually uh the way they do it is with bit math so you know like the date the date list in and the bit count and all those things where they shift the bits over if you have the date list for yesterday and the date list for today and how they shifted you have like what the value is today then you have so you have the two date lists and then you can compare the bits on either side you could actually get all these different states a lot easier like it's like the more efficient way to do it I wanted to show how you can do things a bunch of different ways though because like that doesn't matter quite as much in these cases so um what we're gonna do is we are going to uh how how do you find it I quite like it I think it's quite a good um a good tool and um I like that you can it do and it's it's quite nice to work with we're going to run this and uh make sure uh in the code that I gave you guys uh for for turn this is uh this was like a less than make sure you change that to an equal that was a mistake um okay so that ran and so now what we want to do is we want to just essentially change this to uh move everything up a date so it's the same sort of thing where you change the two dates and then you run the run the query again okay so let's just go ahead and query this real quick so we can say like select star from uh users growth accounting where date is equal to date 2023 0302 we have a second okay so you'll see here so you see this user here is and this it makes sense right so he's uh retained because he was active on both days daily retained and so um let's find a uh there's going to be some users here who are not retain let's say um and daily active State equals turn because there's going to be people who like for daily active right there we go so you'll see like these are people who were just active on the first but they were not active on the second but that doesn't mean that they're not weekly active because they they're still weekly active for the next seven days and so they're still weekly active but now they have turned for the daily active so you'll see how now like we can see these two different ways that these these turn so you'll see daily active actually the state here will change a lot more frequently because it needs to be tested essentially on a daily basis whereas the weekly one gets tested more on like a you know a weekly basis so it doesn't change quite as quickly so like essentially you're going to get a lot more retains for the first like uh seven days right of the of the weekly state so let's go ahead and just quickly uh run this a bunch more times actually I don't I realize I don't need to do that just the Run yeah run the insert we can do three and four and four and five five and six six and \[Music\] seven I'm just going do a and then let's do seven and eight also I had I made a be fallentin day and I can't stop thinking about it it was so good it was so good just different ones here and then we'll just go do one more let's go to the eth because the eth will be where we we start to see a drop off on the um or we'll do the ninth so that we can guaranteed to see a drop off here okay cool so now we have data all the way through to the ninth and let's go ahead and look at that let's look at the the ninth here so we should see some some users who have like dropped off okay there we go so you see we have some like stale users and then we have like oh look at this guy he's retained right because he came back right oh he's just this person's like active every single freaking day that's cool but um you'll see that uh there are some people who turned here because they were they were they were active on the eth but not on the ninth so but well let's uh do a little group by here because maybe there a bug I don't think there's a bug but it just feels like there's an awful lot of retains there oh it's still just new and retained okay well I guess there is a bug here for this is uh where last active date is greater than or equal to y. date minus s days is retained that seems right though because that means that they weren't act how is it like they are all retained hold up because this minus interval okay in here we have retained is it's saying it's why. active date is and it's saying it has to be but this is with today date but this today is null it can it can be null and that's fine um interesting interesting because okay so you have the retained and then and the the and today is null that's how because I got this to work I definitely got this to work this is wild that this is like a little bit off just a little bit off that's what like one of those things about these queries that's like wild is that they um they can be just uh slightly off where um so because if you subtract seven from this and then the date is the last activate is greater than or equal to that minus 7 because okay hold up because if we if we query this and we just say select Star right and look at the data here because we should have like some data here that is a little bit off right because let's see um this first okay and then we can say uh and last active date equals date 2023 0301 so we're just going to do a little bit of troubleshooting here real quick see what's going on so you see okay there are users in here that we have that were uh essentially only active on the first see and then this is weird because the why is it getting a hit like why is why is this retained that doesn't make any sense because this is uh this would be where last active date is um greater than or equal to date minus 7 which would mean that first is greater than the second which is you're saying for for here where uh yeah because well like these these should all be still because these are not active on these have only been active on the first right and this is now the ninth right this is this is for the ninth and that's what I'm saying is that like this y do date here is the ninth like that's okay that's wild okay um anyways there's there is a bug here that I think uh what I'm what I'm going to do here because I want to give time for the rest of the lab here is there's a small bug on the kind of the that this is working because essentially there this is saying this is this is like because wait a minute because somehow this is this this condition is being triggered every single time like that's so weird but um what I'm gonna do is like I want to put a a cap on this because the whole idea here is I know that the daily active state is working and that's what matters for the rest of the class and we can see what's going on there's there must be a small bug with these conditions here but the uh the daily active state is working the way we expect because it's simpler and uh the idea here right is now you can kind of see like if we go ahead and we say date and then we say daily active State and we say count one and then we can say uh we can say Group by uh date weekly or and then daily active State we run this query you can see uh okay we can see when people showed up you'll see and when people okay so stale is like uh all the people who like turned out and they never came back but okay you'll see on uh there was 3,000 new users who showed up on the third right and it it was really hard for me to retain daily active users essentially so there was 287 people who came back on the fourth right and like some people ended up coming back like after churning a little bit but like for the most part they uh like are mostly stale now anyways um that's kind of the idea for uh growth accounting here now what I want to show y'all is how you can use this with first active state to show y'all how to look at retention analysis for cohorts so in this case what I want to do is first we're just going to say select star from users growth accounting and we're going to say where first active date equals date and we're going to use 2023 0301 so we're going to look at this group of users so you'll see we have a weird number of users there's like hundreds and hundreds and hundreds of users here that uh essentially we here now what we can do is let's go ahead and look at this uh over time so if we look at uh date and count you'll see if we group here Group by date you see how it's always the same it's always 171 which is like kind of what we would expect um so if we have 100 so this is a cohort of 171 users that's the total number of users in this cohort um but what we can see is uh we can say what if we say count uh case when daily active State equals uh or we say daily active state in and we want say retained Resurrected or or new uh then one end so let's look at this I think this will uh kind of give a pretty good idea here so but what we can see is uh we can say what if we say count uh case when daily active State equals uh or we can say da active state in and we going to say retained resurrected or or new uh than one end so let's look at this I think this will uh kind of give a pretty good idea here so if we uh sort on date here you'll see this is essentially that J curve that I was talking about so we can it's it's not too crazy to build this out actually like especially if you already do the growth accounting piece of it so what we can do right is we have our counts and then let's go ahead and say this is um as number active and then what we want to do is we want to have one more here let's do a percent right so we have this divided by count one we got a cast of this though otherwise it's going to give uh this is um cast cast this is as real why is it mad aggregation calls not allowed here why not this query looks like that like okay one second this looks fine to me oh this it doesn't like the oh it's because there's oh oh I think I missed a no that looks right count case when cast is real divide but but you can't divide hold up does it will it give it to me this way okay case when in okay fine we'll just we only care about the percent anyways so we can move him and we'll just divide here because it's probably going okay there must have been some I must have uh done something weird but this looks like it's working okay so now this is going to work and you'll see this is let's say this is percent active Okay okay so we have our percent active and then uh one of the things that's important here though is we actually don't like this is working great for one cohort but this is not that good for uh like all the cohort so what we can do right is we want to say date minus first active date as days since sign up or days since um we'll say days since first active we'll say that and you'll see if we do oh we got to then we got a group on that so this is going to give us that kind of Survivor analysis a little bit so you'll see okay uh the first day uh they are great right it's exactly one and then as things go on like things uh get a little bit different so one of the things that's really cool though is now we can actually greatly expand the cohorts here because we can actually remove this filter condition and now this is actually going to give us okay so now we have a bunch of users who some of them like some cohorts are bigger than others because we've had more data right and you'll see but like one of the things you'll notice is oh it's sort on uh da active here so you'll see uh da sense first active we have uh 100% of people which is exactly what we're expecting you remember that chart where it's like a curve and it all starts at 100% And then it slowly goes down and so you'll see that like uh really we only like these last two days we don't want to care about as much because there's not enough data for these two days uh or because we we need to load more data in because you see the number of users here is not very high but for these other days we have a lot of users so you'll see that like okay for uh first day it looks like it goes 100% then 5% and then it then it kind of stabilizes at about 2% so it seems like my retention rate for my website is about 2% of people come back which I don't know that's like it's probably better now I mean this is obviously like six months ago so things have changed quite a bit but this is the idea behind how to uh how to do this right and um like for example like let me just show you how powerful this actually is though right so isn't there like there's a way to do this where uh can we do like um it's got to be a way to do like a month right or got be a way to like so you can add other columns into the table right or like you can group on other dimensions of the cohort or of the users in that cohort so that you can see like oh do users who sign up on Wednesday versus um um Monday yeah I know you mean like um the it's not you can't really see a lot of the screen so you're like kind of having to go back and forth a bit to figure out what it is let's do this again e e or whatever they have uh is like date part okay so um extract day of week and then this is going to be from um first active date as day of week and then we we group on that as well and you'll see in this case this is going to give us a different perspective so still first day looking great right and then you can kind of see okay it looks like looks like what Wednesday it's like Wednesday Wednesday is looking pretty fire 133% but it's also like not enough data in some regards as well right so you can see that you can see uh what day of the week like you can kind of compare these like day of the week like you can see how this could be like a nice line chart of like oh this day of the week is better than that day of the week and then then you can kind of use that to your advantage to like optimize your ad campaigns stuff like that uh so just letting youall know I don't think we're going to get have time for the uh kind of the Rolling window function stuff because we only have like four or five minutes left for today's lab I was a little bit ambitious on how much content to cover here I covered a little bit in too much in the presentation but um I think that's pretty much it for what I was planning to cover today congrats on getting to the end of the day one lab if you're taking this class for credit make sure to switch over to the other tab so you can get credit for the day two okay so I'm going to end there um I understand this bit here um I'm just not sure why I'm not getting a I'm just going to ask chat why okay that's that should cool that makes sense cool that makes sense right cool I'm happy with that I what happened I was just trying to figure out why why it wasn't get the it's not the percentage it's the like fraction like decimal but um it would be that would be equal to 9% so we're good right I'm going to end there thank you for those who have watched um it's been it's been nice a lot a lot people having chat today so that was nice thank you for watching and I will see you next time goodbye everyone


 > [!info]
> - **Repeatable analyses are key to data engineering.** They reduce cognitive load and streamline impact (8:34).
> - **Master aggregation, cumulation, and window-based patterns.** These cover 95%+ of pipelines in big tech (14:34).
> - **Aggregation-based patterns use Group By.** Focus on counting things based on different dimensions (15:42).
> - **Cumulation-based patterns care about relationships between today and yesterday.** Full outer joins are essential (28:31).
> - **State transition tracking is powerful for monitoring ML model health.** Track new, retained, churned, resurrected, and stale states (30:12).
> - **Be aware of survivorship bias.** It can skew your view of the world (36:04).
> - **Window-based analyses include day-over-day, week-over-week comparisons.** Use rolling sums and averages to reduce volatility (44:31).
> - **Partitioning is important for window-based analyses in big data environments.** Avoids OOM errors (56:04).