---
title: "DataExpert.io - Day 3 Lab - Data Engineering Bootcamp"
author:
  - "Jade Codes"
published: 2024-11-27
source: "https://www.youtube.com/watch?v=2EqdEVHI-dc&t=5239s"
image: "https://i.ytimg.com/vi/2EqdEVHI-dc/maxresdefault.jpg?sqp=-oaymwEmCIAKENAF8quKqQMa8AEB-AH-CYAC0AWKAgwIABABGGUgZShlMA8=&rs=AOn4CLDMMUBUiPrpIBkbBwZbwjhc5tCLSw"
created: 2025-03-23
tags:
  - "youtube"
  - "data_engineering"
  - "graph_database"
  - "postgresql"
summary: "Day 3 Lab of a Data Engineering Bootcamp focusing on graph data modeling using PostgreSQL to analyze relationships between NBA players and games."
---
# DataExpert.io - Day 3 Lab - Data Engineering Bootcamp

![DataExpert.io - Day 3 Lab - Data Engineering Bootcamp](https://www.youtube.com/embed/2EqdEVHI-dc&t=5239s)

> [!summary]- Description
> Thank you for joining me on my Data Engineering Bootcamp journey!
> 
> I'm so excited to have you here as we work through this incredible free bootcamp together. A huge shoutout to Zach for creating such an amazing resource!  
> 
> Before we dive in, let’s go over a few quick house rules:  
> 1️⃣ If you’re also following along with the bootcamp, make sure you check out the official site at:
> https://bootcamp.techcreator.io/ 
> 2️⃣ Don’t forget to watch Zach's videos directly too! He deserves the watch hours, and you deserve the credit for completing the bootcamp.  
> 
> This bootcamp is completely free, but I also want to let you know I’ll be joining Zach's paid bootcamp in January. 
> 
> If you're interested in leveling up your skills even further, you can use my link for 20% off: 
> https://www.dataexpert.io/jade
> 
> Thank you again for being here, let’s make the most of this bootcamp and learn some amazing skills together!

> [!note]- Transcript (Youtube)
> for for for hello everyone so we are on the day three of Zach day um data engineering lab and yeah so I this is um like something that's new to me this topic I haven't done um I haven't worked with graph database before so looking forward to doing the lab learning about it and figuring out where the freaking hell I put my bloody cheat bar there we are okay cool so um yeah let's get into it so we're using post rescu again today so I should be able just to use PG admin again so what I'm going to do is I'm going to put them side by side again and we're going to use hopefully I think the same data like tables but like I think we're going to be using different different tables in the same um PG admin so let's get going \[Music\] welcome to dimensional data modeling day three lab in today's lab we are going to be doing a Hands-On exercise where we are going to be building a graph data model to see which NBA players play with each other in games and which NBA players are a part of which teams at which time so we will be building very data agnostic thing in postgress that will allow us to analyze these complex relationships between players uh to be ready for this lab make sure you have Docker installed make sure you have the repo in the description below cloned and that you have Docker up and running and you can connect to postgress with a visualizer something like data grip or DB visualizer or D Beaver one of those SQL editor tools is going to be super important to get you to where you want to go here you could use PG admin too I guess but I hope you enjoy the lab today and if you want to do more of these Hands-On exercises with hot Technologies like Iceberg and trino definitely check out the data expert Academy in the description below and I hope to see you there so the presentation right so I am using um PG admin just because it's free it's easy to set up and um I was able to get it set up with my dock compos file so that's why I decided to go with PG admin and I've never had an issue with it so that's why I've gone with PG admin but if you're more familiar with the other tools feel free to go with those other tools we talked a lot about vertexes and edges so that that's what we're going to do is we're going to do a create table here we're going to call this um call this vertices right because that's the actually the correct name here so then we're going to have identifier that's a text and then you have a type which is going to be a Vertex type oh I already have vertex type in here okay well I need to drop vertex type in because I want to make a new one can you drop it like that okay fine got to do do it this way so I can start over Okay awesome so now that's dropped okay so what we need to do is like you'll see we're going to have a type here that's a Vertex type that is going to be an enumeration obviously it's red right now but that's fine but like the last column here is going to be properties and like the thing that's dumb about postgress is it actually doesn't have um a map type uh so we're going to be using uh properties as a Json type which is essentially the same thing uh it's a little bit more flexible than a map but not that much more flexible uh anyways uh we have our um verticy table here and uh the primary key verticy table very easy identifier and type right makes sense uh so we need to do a create type here vertex uh vertex type uh as enum and then uh our enum values here are going to be player team um I kind of want to put game in here as well let's put game in here as well I think game will work because we can have like an entity which is a game because that's in our uh we have games as a as a table here so I'm I think I'm good I think I'm good with that I need to I need to refresh this this is actually off right because there should be okay well that's fine U so we can go ahead and create this type here makes sense and then uh because we're there might be Arena but ARA I I when I I remember when I was doing this hi quiddle nice to meet you nice nice to see you from LinkedIn I think most people to be fair come from LinkedIn um yeah I I typically when I post a like YouTube video on LinkedIn I do know is like an influx in my analytics of things that go up so yeah I definitely think most people who come to my YouTube channel come from LinkedIn in the rehearsal I realized Arena and team are one to one because a team only has one Arena that they play in so it's like that's a dumb thing to add like you might as well just put team so in this case we have our vertex type created now we can create our verticy table vertices already exists okay well we need to I need to drop that table that's wrong I have all this like dumb data in my freaking database right now that's not good okay so now we can go ahead and create this table great can confirm when doing like I I do this all the time when I'm creating some sort of tutorial on something you always have to make sure that you clear it down because yeah you just do it with with you want to make sure that you're starting fresh every time we have our new vertices table um so let's get all of our ddls out of the way real quick so what I want to do is I want to say I'm going to drop type Edge type as well I'm me to do a Cascade here also I've I've like played around a little bit with the OBS settings to try and get the audio quality better just because I noticed there was a little bit of noise in the previous uh videos and I wanted to reduce that noise so please let me let me know if there's still a little bit of noise there my headphones are really good for like filtering out any like noise so it gets a bit little a little bit annoying cuz I have to like take things out and test things but I'm hoping it's a lot better but if it's not then I will try again to improve it we need to get rid of this guy and we can say drop table edges y'all probably don't need to do this because you don't have these tables but um let's go ahead and say we're going to create a type say Edge type as enum and in this case uh we're going to do a couple here right um so we got to think about the the the relationships here right so I think we're going to say um plays against right is probably one um maybe shares team or something like that like because there's like because you have plays against is like player versus player but you also have like if they're on the same team right where it's like you have like Michael Jordan and Scotty Pippen or something like that that's why I like shar's team okay that's great yeah so I added some filters um which is really really good because I do have my U washing machine on right now and I can hear that quite a lot in the background so it's good that you can't hear that thank you for the feedback but like you can almost you could do that through the team way as well but that doesn't cover the case where what if two players are on the same team but they're on the same team in they're on different teams right now that is where things get like a little bit dicey so I think that I'm going to keep shar's team as that's like a that'll be a player connected to a player but they're on the same team and this is player connected to a player but they're on a different team and then we're going to have um we'll say maybe uh plays on um plays we'll say plays in and plays on so in this case a player plays in a game and a player plays on a team I think that that's pretty pretty good I like I think I like that as our kind of edge types that we can work with here um okay so let's go ahead and create uh this Edge type here um great so now we have another uh table here I say create table this case this is going to be edges and then uh remember we go subject identifier text and we have subject type this is a vertex type then we have object identifier text and then we have object type which is a vertex type and then we have Edge type which is an edge type I need a comma Edge type and then we have properties which is a Json all right so one of the things the great debate one of the things that I find like working from PG admin is I don't have um co-pilot with me so like co-pilot like often Auto fills so much of my text for me but um but yeah that's that's something that's difficult to get used to because I um I'm just so used to like it helping auto fill things for me so that's been fun when doing it cre admin but I think it's important especially when you're learning to try and remove the co-pilot side of it because Co pilette can literally populate so much of the um the like queries and if you don't understand what the queries are doing then it can be a bit of a nightmare to new bug about this is like what is the freaking um primary key of this edges table like and the primary key of this table is actually um and it's really nasty it's actually a subject identifier sub it's like essentially all the columns right except for properties subject type object identifier object type Edge type that's the um this is the primary key you have all of those together some in some um graph places they actually have another column here called like um Edge Edge ID and they put like a text here so that you have like a a surrogate key I think for our intents and purposes we don't want to do that because we have freaking 45 minutes to do this and I'm this is more like a coding interview exercise than building out an actual graph so this probably makes sense so far um so what we want to do here is I want to look at uh game details real quick so we're gonna I want what I want to see is because game details has uh the actual game information where it has like the player and the team ID all that kind of stuff but we also have um uh the games right so I think games might be game is probably the first one that we want to add because I think that one will probably be the easiest to add um so let's go ahead and create game as uh um as a Vertex type so in this case uh I'm gonna so this is like the ddl one I'm just going to make a new sketch pad here so what we're going to do is we're going to say um select star from games and I think that's a pretty good idea actually like because um I think a lot of people think that you can just use co-pilot and it'll do everything for you but the amount of things that you have to then change or like um tweak to to get it working the way that you want and don't get me wrong it's still a massive time saer we're doing that but you have to be very intentional with what you're doing to make sure that it doesn't like just produce a load of garbage but I found that with most um llms that I've worked with to be fair obviously this is already duped right so we don't need to aggregate at all we just need to essentially uh move this over into our um into our other values like do we have teams in here what's in teams does teams have an ID okay good teams does have a team ID here so we'll we can do use that to join um okay this this should work great then so in this case we have games um and what we want in here is this is going to be our verticy right but it's like this is where it's interesting is is a is this a Vertex or is this an edge that's another thing that I think is an interesting uh thing but I I think of it as it is mostly a vertex in this case so uh the identifier here we're going to say is game ID as identifier and then the type right game and we want to do colon colon vertex type as type and then uh we have uh so this is this cool thing called Json build object uh so this is essentially where we can get our um our like values here right so in this case we have I I like a couple of these I like points home and then there's points home and points away points away right and then it's like you want to see who is the winning team I I think the winner here is also a good idea to see like winning team and losing team and I mean the rest of this like we could put in there but but like I I mean I don't necessarily like it so it looks like there's actually this column at the end here home team wins right so we can say um winning team and this is going to be uh case when home team wins equals one then home team ID else visitor team ID end right so let's look at when this is as properties so this is probably going to be a good enough like sample for us so back because I didn't quite get that what you did I mean the rest of this like we could put so it can easy get you frustrated when you don't use it right and a lot of people I talk to they say it's garbage but actually don't know how to use it one tip using w space when you're working on Reaper why change is such a useful thing and now you can use CLA W and comp as well I was so happy when I saw that upgrade sorry for dis scratching you much completely fine don't worry about it um yeah yeah it's not like um I wouldn't say it's garbage I would say if you use it if you just blindly follow what it says I'd say that's when it can be a bit garbage you have to know when to use it when not to use it and to know when you need to explain something differently as well because a lot of the time it's you not explaining things correctly and sometimes it is just a fact that like especially when you're doing something that hasn't been commonly done before I find that quite difficult to do with K pilot so like I do a lot of um research and Discovery stuff in my part as part of my role and there are just things that are very very difficult to find on the internet for what I try I'm trying to do which is a nightmare for for for using llms put in there but like I I mean I don't necessarily like it so it looks like there's actually this column at the end here home team wins right so we can say a um winning team and this is going to be uh case when home team wins equals one then home team ID else visitor team okay it's fun ID and right so let's look at when this is as properties so this is probably going to be a good enough like sample for us so um you'll see uh we now have the winning team and we have all that stuff right um I I like I like this as our kind of edges because we can then um see how these connect because we also have a teams participate in games as well right but this is the main idea that I think like is this is probably good enough for us to create our first vertices right so we can say insert into vertices and this will give us our uh okay good Done Right games done easy so one of the things that I also want to help you guys understand is that like this is actually not too crazy so awesome um I think for uh player player is going to be a little bit trickier but we can uh essentially like I actually um so I know that like I actually pulled some of this data from different data sets so we have player Seasons at hi hi python Hi Sam how you doing it was nice speaking with you earlier as well um me and Sam had a had a one to one earlier which was nice to nice to speak with him and yeah like I said please like hit the like button if um this is useful at all um yeah it's I think for me it's I I quite like it even though like you know a lot of the time like there's only a few viewers at time just because it it's nice to do this with someone rather than just doing it by myself because I feel like when I do it by myself I am much more likely to get distracted much more likely to go on my phone um but yeah uh I I really like being able to just talk and you know say hi and actually do the labs with other people so it it works really well for me and as the homework just I've noticed the homework ones are definitely getting more views and more watch hours but I assume that's because people just want to be able to see how to do the homework and and whereas the labs they can watch the labs directly and the labs are more just to you know have a conversation and say hi so which is absolutely fine I'm completely happy to have a conversation and say hi with everyone as um one table but this is different I actually pulled these this is like a mix of a couple so I actually want to get player from Game details because you see how we have this player name here as a column so what I want to do is like we can essentially use this uh we can aggregate this one up and that will give us uh our player details because then we can get like their entire career stats like their Min and Max Games all sorts of stuff like that so um uh let's go ahead and uh one second let me let's do this so we can say uh select star from game details and in this case we want to say uh we'll say player ID and this is going to be as um uh identifier right and then we're going to have a player vertex type as type and then uh we need a group buy here actually so let's get rid of this first let's we need a this one's going to be a little bit more complicated so what we want to do here is we want to say count um count one as number of games right U maybe \[Music\] sum uh points as total points uh what other things maybe uh I like um oh yeah because we also want um we can get the the teams the we can get that connection here as well probably so maybe array a uh Team ID but in this case you want to put distinct here this is as um teams played on or we would say teams we'll call it teams so this case if we say a group by here say Group by player ID okay so you'll see so I'm just going to go through and these so we saying oh my God and I just realized as well like please tell me like now we've gone from in here where we have actor ID to player underscore ID like why why they do this to me okay so we're getting the count of games that they've played that's fine and then we're getting the um total points that they've had team ID but in this case hi Tom thank you that's really nice thank you you want to put distinct here this is as um teams played on or would say teams what called teams okay so we're doing we're doing this distinct because we we don't want to repeat the same team so a player might play on like the same team multiple times but you don't want to have to keep doing that but a playm also play on like two different teams so you still want to aggregate the results because you will have um the player in in multiple teams you don't they don't just play for one team so you wouldn't just select the one um so that's why that he's doing both there so you can see most people only play on one team but there are a few scenarios where someone has played on multiple teams especially when they've got they've played a lot of games so yeah they've uh I imagine these are madeup figures but they've clearly made a lot of money in in their time playing as NBAs this case if we say a group by here a group by player ID also like I don't know like if people know this but in in in the UK like this n NBA means like very very little to us we don't know that like for the majority of people in the UK like it doesn't mean and like I have no idea like I know I know like it's really really big in America but I I'm not um I know that like but here it's barely talked about so it's just a really interesting like difference between different parts of the world okay so you'll see here how then you have okay this person played on three teams and you have like all their points and all the connections right of everything here so this is a pretty good uh like I like this as our kind of full query here so I'm gonna say with players a we probably want name as well though right you see how like we have identifier but we also probably want name right so we're going to say max player name as player name this is probably a very strange thing to see here this Max but like you can put Min as well right it doesn't matter because it's always the same value we just need one of them and that gives us because we want the name of the player as well because this ID is kind of worthless um so what we can do here is okay so he's doing Max play name instead of doing an additional group bu um so so this particular course that I'm doing at the moment is free so he's got this course which is free um and if you go to uh Tech Creator boot camp. Creator I'm pretty sure that's the link you can join it there this course is free there is there is also a paid course which if you did want to do I do have an affiliate link and I'll link it below uh I even have my own little link but 20% off so I really like the car so far um I think it's free so there's only only um so much you're going to get from a free car so that you do have to do a lot of things yourself uh I I did I have bought the I have bought the the paid for course so that is something that I did I bought the course for the paid version and then literally the week after the free one came out so I thought well if I'm doing the paid version I might as well do the free version First up skill like like with a bit more of the basics and then be able to hit the the ground running with the paid version um so that that's my plan basically uh so I already bought it basically um and then yeah and then I joined the free version but it's been it's been good uh I think I think you definitely have to be quite self-starting there's a lot of things that I'm just doing myself but to be fair I'm not one of those people who are very good at like asking questions cuz I like to solve the problem myself so when I'm doing something for learning I like to solve the problem myself and figure out a way to do it and then I only really ask the question if I get to a point where I absolutely cannot figure out myself um at work it has to be a bit differently because you've got time skills and stuff but when it's my own learning I I like to do things myself so I I'm fine with that but I think some people might struggle with that because um yeah there's a lot there's not that much handholding you are expected to be able to do a lot of this yourself and there is a good Community there so if you do get stuck and you do want to ask questions you know there are like discords and stuff like that I haven't like used them as much as as other people have so that might be something that might be beneficial for you if you are like thinking about siging up you can and and you can always try it out and if it doesn't work for you then you know it it hasn't cost you anything other than your time and commitment so for me like the biggest cost for me is is the time aspect so this is this does has taken me um like this plus the homework and and and and just the general thinking about it as taken over like 10 hours of my time over the past past week so you have to have the time to be able to commit to it basically say with players a as then this is going to give us our aggregated view and then what we can say is we can just make this pretty easy on it we can say select identifier and then we have so if we're going on the previous one um I assume that's going to be player ID as identifier and then we're going to have player vertex type as type and then we're going to have the Json build object and then we're going to have uh um name name we're going to have number of games new games yeah of course I don't I don't know if I can do that on here is there a way to turn on is there a way to turn on captions for the for the live streams I'll have to figure that out let me just finish this and I'll I'll see if there's an option in YouTube settings to turn on the turn on the captions so I'm going to assume that's what he's going to populate but that might not be the case um so I'm just going to see if if that's what he's going to do vertex type and then we got to do the Json thing right Json build object in this case we have player name player name then we have uh number of games number of games oh let's put from players a here and then kind of just make this a little bit nicer so then we have uh total points total points and then we have uh teams and then we have uh teams and so this should work and it should put like that teams into like a little array okay that okay so I'm get an error outline that 23 yeah uh player ID does not exist why does player ID not exist is three h identify that's fine we've already labeled the identifier there we go perfect I watched the course after my job so you'll see here if you can see the little time at the bottom it is 10: to 11: at at in the UK so it's quite late but I'm a night owl so when I went to University I used to go to university at 6:30 p.m. um and then I would literally work from 6:30 p.m. to 2: to 3 p.m. in 2: to 3:00 a.m. in the morning because that was when I was most productive I much prefer working on the evening than working in the day so much it's so much more productive for me I get so much more done and I just find like in in general the um the day is just I feel like night hours have had to adapt to be like um day people like just to please the rest of the world so I would happily like just like sleeping until like midday if I could but I've got I've got kids so I can't do that unfortunately but yeah that would be that would be the dream okay there we go so now we have our see we have our player vertex type and then in here we have all sorts of interesting like teams and stuff like that so this is pretty good I like this as our um next thing so we can say insert into vertices oh it because oh you need a here or semicolon here and this will okay so that ran that ran great now we have our so let's get the last bit here right because if you remember we had the three we had games players and teams so teams should be easy teams is going to be easy like the last one so we can say like select star from teams we'll just see like if there's any other um like maybe metadata we might want to pull in okay so maybe like the arena like Arena and City and then obviously this is the identifier but then we have to bring in like the nickname and stuff like that as well so in this case we're going to have uh Team ID as identifier and then we have Team vertex type as type and then uh Json build object and then in this case we have uh maybe abbreviation abbreviation nickname nickname uh city city Arena \[Music\] Arena um I'll put year founded in there too but I'm putting an underscore in there there cuz I hate that that doesn't have an underscore there should be an underscore there the iron of what he just said then I'm going to put an underscore there because it triggers me that there isn't an underscore there and I'm just going to point you to this again this actor ID here can you see it where there isn't an underscore what up Zach what up that'll be the last time no it won't be the last time but yeah aren't you tired watching and making this task of course after the work especially at night sometimes I am but sometimes you just got to get over these things you see like like sometime I strongly believe like it's either this or I was I was doing content creation anyway so you'll probably notice that I'm doing less content creation at the moment I guess this is kind of content creation cuz I'm I'm I'm live streaming it but I'm not doing much on LinkedIn at the moment and um and sometimes you just got to you got to sacrifice for the things for the things you want in life and one of the things I want in life is to get better at this stuff so um so yeah I just got to got to suck it up but to be fair if I wasn't doing this I'd be I'd just be doing stuff on on on um what's it called LinkedIn and content like creating a newslet or whatever anyway so it's all the same stuff really it's all work that needs to be done and it's all tiring stuff so yeah and thank you hi Damien nice to nice to see see you and I am good thank you how are you um uh I don't care about the rest of these columns I don't think they one thing that's interesting is like all I I guess just interesting to me is what what what makes him decide on which columns are important and which ones we don't really care about is that something that you um Define with the the people who are getting the data from you I guess it's just kind at the moment he's just telling us the columns that we want to be using so it's like okay well you know what made you come to that conclusion what when you say me too Sam what what sorry what were you referring to because I didn't get to like see your comment then awesome nice to nice to chat with you anyway and sleep well is the free course enough for your job so I don't really need to know I don't I don't need like to do this for my job like this isn't like okay if you don't do this for your job you're not going to progress it's just an area that I would like the um my job to um go into so I don't need it for the job that I have but if I want to get more involved in the data side of the projects that come in then this is a great opportunity to be able to do that I'll put year founded in there too but I'm putting an underscore in there because I hate that that doesn't have an underscore there should be an underscore there um uh I don't care about the rest of these columns I don't think they freaking matter so uh this is probably probably good enough for teams so you can say um insert into vertices we just got to put another semicolon here then this will give us our team wait there's dubes yeah yeah I'll share this code just um I just like what the hell there's like there's dupes in this why are there dupes did this like this is like not there's like three of everything in here okay fine we will just uh I I think I I when I loaded this data in postgress it's like broken like you see how there's like triplets it's like like all of it's the same but there's like three of everything I mean that's fine all we got to do right is I think if we just put like group by um oh wait we got to put that group by first here but like okay so if we put oh this is going to be actually super an annoying but um City Arena oh wait no no no no I know what to do I know what to do this is going to be where you just put you do a CTE right so you say like um with teams duped as and you say like uh select star from um teams and then you want to put a row number in here right so we can say row number um over Partition by team ID as R num right and then what we can just do is we take team duped here and we say where teams oh no we change this to teams D duped and we say where R num equals one and now this will work because apparently there's duplicates in there I don't know what happened there like there there there shouldn't be but there is so now this will work this will run so um we now it's fine um okay I'm Senor now am I planning to switch to manager Ro engineering manager or something like that I want to improve myself with technical side and become a tech lead and architect I I haven't decided like fully yet I definitely am interested in the leadership side of stuff so I do really enjoy mentoring people and I really enjoy like um the the line management responsibilities that come with that I used to do line management only briefly at my preview Ru um and I did really like that so I would love to be able to do that again um it is just one of those things that like um um it's one of those things where when you get to a company like Microsoft it's quite hard to like just um it it's quite hard to you get to a point where it's quite hard to progress in into that just because there's a lot of people there's a lot of competition um and like for example in my department you've got a lot of seniors so you have a lot of like if you look at my department there's so many seniors and everyone wants to progress and not everyone can be principal and not everyone can be a like principal lead for example so you can end up a bit stuck really so I don't really know do is we take Team D duped here and we say where teams oh no we change this to teams duped and we say where R okay so if I this then I quite like Edge to be fair I quite like Ed I I still use Google for my um search but Edge is pretty pretty pretty nice to be fair it's pretty much the exact same like it's a carbon clone of CR to be honest so okay so this is just selecting just adding row number there as well that's fine so then we only select the first one that's that's pretty neat I quite like that not really sure that's the correct word but um Rose I just Chang the name here team Rose because technically this isn't dup in anything it's just adding on what row number there is okay so peral and now this will work because apparently there's duplicates in there I don't know what happened there like there there shouldn't be but there is so now this will work this will run so um we now are essentially we have the all of our data for the most part now at least the very first bit of this we have all of our um we have all of our vertices in our table now let's um let's go ahead and just like look at some of those real quick so we can kind of I I want I just want to illustrate some things to y'all to see like how this works so we can say select type from vertices right and then we let's just do a count real quick so we say like count one group by one right so this will give us our okay so in this case we have um 30 teams 15 almost 1500 players and 9,300 games uh that's pretty cool um so what we want to do right is if you remember we want to start looking at some of these edges right so um let's I think the easiest one here to start with is going to be this um plays in I think that's probably going to be the easiest Edge to start with uh because that's just game details it's already at the right grain for that uh I think that that's probably going to be the because some of these other ones we have to actually Aggregate and play plays against and shares team those ones are going to be those ones those ones are the nastiest of all but we will uh we're going to start here with this plays in so in that case right so we're going to start adding to the edges table a little bit so we're going to say select star from game details and in this case right we have U we have all the stuff right and then we need to get our subject identifier subject type right so in this case we have a player ID as subject identifier and then subject type here is player castes to a Vertex type as subject type and then we have object identifier so in this case object identifier is game ID and then we have object type which is a game right and then we have our Edge type right so Edge type in this case is going to be plays in is Edge type and this is as Edge type and then we have our properties right so then we have uh this one's kind of cool so we say Json build object and then our properties in this case are what about this so this is a player in a game right so in this case we have their start position right which is uh like Center forward fast don't you think I see the ch hi mdz it is going well thank you how is it going with you word whatever um I also like the points right there's going to be points probably right there's going to be yeah points is at the end here um anything else that I really care about uh I like the team ID I think like because you can put te but team ID is really more of like an edge right because you can like but because that's going to be in this game but no but you actually have to have in this game this player because there's all like all three of those together so we're going to have um Team ID team ID right and then probably um Team abbreviation so this is going to be um as properties right so this is pretty close I think that this is pretty much what we're looking for in terms of our like getting everything into the right schema so uh what we can do here is we can say um insert into Edge edges supp it is transforming a lot of data and oh there's a dupe okay why is there a dupe there um that's interesting there's a there's some there's like a data quality issue or something with uh the game details apparently because there's like a there's a there's a player who has two records in here so what I want to do is I want to look at that record real quick so we're going to say select star from game details where player ID equals um is it this and game ID equals this like why is there two records here that's weird okay there's not two records there's freaking six what is there is there six records of everything though one second I gotta see this now I say player ID what's game ID count one do I like mess up here as well is there freaking like a lot more data in here than there's supposed to be like is there's always okay so it looks like there's always three essentially okay there's like I so when I was like importing some of this data in the postgress like it like duplicated again so uh we have the same problem here as we did in the so we just want to the same steps I guess um with um with game detail rows uh Partition by uh me Partition by two things um in that last example right where we need to uh essentially uh put in that ronom right so we're just going to say DD to as we're going to say uh select St are from game details and then in this case we can just throw in that row number and then uh the Partition by here is a little different right we're going to have player ID game ID yeah as a row num and then we can just essentially use this instead of uh that I'm say wear row num equals one the cool thing about this though is that like even if there is no dupes this query still runs so this gives us our uh kind of edges and we need to actually uh essentially I'm going to work with we're going to need to work with this dded essentially the whole time B right this is doesn't do like multiple degrees but this is what this ends up doing where you get your um properties plays in and you this is a way to and then you could aggregate these things right so imagine like what we can say here is you see how we in here we get points right we get points so in this case what we can say is we can say e do properties and then we can okay cool that's good yeah now the group by the Partition by IDE and game ID is good spell now do points I don't know if y'all have seen this before but this is uh so then we can say uh average or we can say Max say Max here and then what we want to do is we're going to say um V do identifier or I think it's even easier v. properties again and we can say player name and then Max of that and I'm just going to put Group by one here so this is going to give us uh there we go so now this is every player and um we can put an order by in here too we say order by two descending so this should Kobe Bryant should be number one here right no oh NS it's because oh these guys it's because these guys just never never played why is it always nine that seems incorrect I must have like when I made the edge this is not right whatever whatever's in points here is not right cuz nine like how is it all nine oh oh oh oh oh I know why I know why okay so here's here's this is a great this is a great example of how working with graph data is a problem right because what I'm trying to see here is like what's the most points that each player played in a game but the problem here is it's actually treating this as a string right because it's a Json so if we change this and we say cast as integer this will not work there we go that was the problem and then oh null is still first for some reason but uh then you have uh Deon Booker I guess okay so so what is it these are all M what do they say okay that's fine so we want to do select V properties max what does this okay all right did it does it basically get the value for player name and then we're also getting the value for points but getting the max value think yeah so I assume that we're getting that column and we're getting that column join edges e on that group by one okay not true Kobe Bryant is not is is his his 80 point game isn't in the data set apparently but okay but he's up here he's got he's got a 60 point game in here so uh this is how uh I would imagine that like you see how like we can get new kind of relationships here that this one isn't that interesting because we could just aggregated game details right and that is fine and that is like that's why I want to like show you other uh kind of connections here besides just plays in so this is just our first kind of way of going about it so now what we're gonna do is we're gonna do one that's a lot more complicated so what we're gonna do here is we're going to create uh um some more data here let's let's go down here and just gonna here I'll I'll paste this to y'all too if you want to see this query like it's like a it's more of like an analytical one that's like not as like critical to uh like to the the rest of it uh yeah go ahead Sean m okay so we're just making it an integer rather than a string which is what it's currently identified as at the moment uh yeah I mean uh oh the the oh this data model right and everything and this like yeah I mean there's going to be other options there like there's this thing called post graph right I mean the that visualization of the graph and everything like uh is kind of outside the scope of this presentation I'm this is more of like very narrowly focused on the model itself right uh but like yeah that that'd be a cool thing to that'd be a fancy obviously that's like a in in a later version if that's like an easy thing to slap on right then to give people the wow factor for this that's definitely something I would want to add so um yeah for sure that like uh but like yeah like I I don't know of any like easy ways to do that like just like out the box there probably is there probably is I just didn't do any research on it so um what we want to do next here is we want to create uh uh I'm going to call one called here is filtered this is where like I wish qualify existed in freaking postgress but it doesn't like this is where um where you have to like have like two CTE here right essentially so we're going to say d duped where R num equals one where or Rum equals one so now this is just like we just want to do this so that we have our DD data set so what I want to do now is I want to create an edge that is where we have plays against um between two players right and there's going to be some interesting tradeoffs here because of the fact that like we're gonna this is actually going to create two edges uh where you have one on either side because we're going to be doing what's called a self join here right so if we say select star from filtered F right let's just query this real quick so you'll see okay we have our games all D duped looking good but what we want to do here is we're going to do a self joint so we're going to say select star from filtered F Jo join filtered or we're going to call this F1 and F2 um so in this case we're going to join these uh and then our on here we gonna say f1. game ID so we're doing a with um game \[Music\] detail and then we do uh select um and then we do this partition here um detail and then we do a SE duped one as well as and then we do uh \[Music\] doal one or equals f2. game ID right and um F1 do uh player name does not equal f2. player name so this will give us uh so let's look at this real quick so if we say um f1. player name f2. player name and we want to say f1. team abbreviation f2. team abbreviation just gonna put that in here for now and it go so fast isn't G ID F2 ID and F1 player name does not equal F2 player name this real quick so if we say um f1. player name f2. player name and we want to say f1. team abbreviation f2. team abbreviation just going to put that in here for now and uh you'll see how this kind of this query kind of work works okay so you'll see we have our um we're going to have both here right where this is going to be a game where um so this is Kyle Lowry and Steph Curry right but this is like a Toronto Raptors versus Golden State Warriors game right but they these are people who are playing against each other but then here's Kyle Lowry on the same team as this person here right so what we can do is we can actually generate both types of edges in one query here around um uh the what try say here around like both the plays the teams with like the team one and also the the other side the the one around um playing against right so you have on the same team and playing against here so in this case we have uh all these things together so what I'd say here is I say case when f1. abbreviation equals f2. abbreviation then in that case we have uh teams with right and this is an edge type and we have an else here and the else here is plays against yeah that's fair okay that makes sense then Ed no you don't need to put a bu in the partition um shouldn't need to shouldn't matter because you're only selecting the first one so it doesn't matter cuz even if you didn't like YouTube so I just got an error saying that YouTube is not receiving enough video what does that \[Music\] mean okay no you don't have to put the autobi clausing because you just select in the first row for that partic and you're partitioning by the player ID and the game ID so it doesn't matter so each one is has the row number for it so it'll do just say you've got a player um called Steve and he has three rows it doesn't matter where it is in the actual data his one row will be one the next row will be two and the next row will be free even if it had even if it wasn't ordered by um player ID so it doesn't matter and this is an edge type and this is an end right so now this is going to give us uh we need to put the player IDs in here as well though because we need those identifiers right we got put player ID and then we can say um f2. player ID we need all of that so then we have all of this right and then this is uh oh is it not teams with what did I what did I call it shares team I called it shares team that's the problem so see this is why you use enums though you see how like if we just used a string here then it would have just been bogus right and we wouldn't have the that consistency this is just a great example of how enums catch data quality issues right teams with is it oh it's oh wait I messed up that that this one's plays against and this is shar's team that's the problem okay so now you'll see how we have uh we got our player IDs and then we have play against and shares team so now the thing is is like this is going to create an edge per game and we don't want that we actually want uh an aggregation of all of this right that's the main thing that we want here is we want uh an aggregation of both sides of this so we're going to have uh let's go ahead and create that aggregation so in this case what things do we want we probably want uh we probably want points and games right so we can say count one as numb games and we have some um f1. points as I'm going to call this like left points because I like you have the player on the left and the player on the right side of the join right and uh we need both right f2. points as um right points I I I don't know the better name to call that but so now this this query we need a group by here right we're going Group by it's going to be like one two three four five don't do this in production if you put this nasty stuff in production like I I I'll I'll no I'm I I I you know it's not do as I say but do as I do right okay um now this query should we run all of this we should have okay there we go so now we have okay we have Anderson this guy versus this guy they've played plays against oh did that not that didn't run like because it didn't give us the rest of those columns can I like stomp this let why didn't that not run oh oh it's because it's still running there we go okay it was it's because this is actually a lot of data right okay so there we go so now we see uh we have the number of times as this guy they've played as this guy right points I probably want right and and like I I I'll I no I'm I I I you know it's not do as I say but do as I do right okay um now this query should we run all this we should have okay there we go so now we have okay we have Anderson this guy versus this guy they've play plays against oh did that not that didn't run like because it didn't give us the rest of those columns can I like stomp this let me why didn't that not run oh oh it's because it's still running there we go okay it was it's because this is actually a lot of data right okay so there we go so now we see uh we have the number of times okay so you'll see that um Tim Duncan and Tony Parker have played 42 games together right and then you can see how much the left points got and the right points got so so um all right okay are we doing a I just I just missed something here did move the group by up okay so he so fast right and we need both right F2 do points as um okay so you'll see that um Tim Duncan this we should have okay there we go so now we have okay we have Anderson this guy versus this guy they've played plays against oh did that not that okay so we then do group by f1. play name I swe like I missed that but have to pretty much all this really um this is not nice no see you that didn't run like because it didn't give us the rest of those columns can I like stomp this let me why didn't that not run oh oh it's because it's still running there we go okay it was it's because this is actually a lot of data right okay so there we go so now we see uh we have the number of times okay so you'll see that um Tim Duncan and Tony Parker have played 42 games together right and then you can see how much the left Point Scott and the right points SC so um there's going to be a lot of combinations here there's going to be and one of the things that's a problem here is going to be the fact that uh there's going to be two edges here you have the Tim Duncan Tony Parker Edge but you also have the Tony Parker Tim Duncan Edge and you really don't need both right that's just like a duplicate Edge right it's just like it can be on either side it all depends on like how you want to do your graph modeling so sometimes you want both edges so that like the query patterns are a little bit easier because then you can always query on subject and that works fine but uh on the other side like if you just 2x your edges because this because this is a great example of where uh this is a two-sided uh connection right and who is the subject and who is the object here does doesn't matter right because they are playing with each other right it's like Tim plays with Tony and Tony plays with Tim right they like are like it's it's it's just a double-sided Edge so in that case what you can do uh to like make sure that like you get like just one set of edges which is what we're going to do is we're going to say where f1. player name is greater than f2. player name which is a string comparison but this makes it so that like uh like whichever one is sorted that way like this this makes it so we don't have the double edges right we like we will only have a single amount of edges here so this query is getting pretty close so let's uh let's go ahead and put this in like a one more CTE and then I'm going to paste this to y'all this is going to be our uh um this is our kind of aggregated CTE so in here we can say like star from aggregated and this is going to give us our uh oh yeah this is I forget we can't just like I need to like like actually uh this this query takes a like just it takes a little bit of time right so um in this case we want to now build out our identifiers and stuff like that so in this case uh I'm going to call this uh as left player ID and this is as left player name and this is as uh right player ID this is as right player name uh just so we can have left and right we have we keep everything in there and this is as Edge type here so I think we're pretty much here we get like okay hold up I don't want to use left and right here because that's freaking inconsistent we want to call this just subject we're just going to be uh canonical here subject and object so yeah this okay so we have our subject I player ID object player ID okay we are getting real close here we we we are okay so we have a subject play ID and we're going to call this as subject identifier and then we have um subject oh no then we have subject type right in this case we have player so we have a Vertex type this is as a subject type here and then we have object player ID as object identifier we real close here and we have player again as vertex type as a Vertex type and then we have our Edge type which is just Edge type as Edge type okay so we need to do select as subject \[Music\] identifier player subject Ty object player ID as object \[Music\] Iden player as right and then oh this is my bad object type here I thought it was object type last one which is our property I shouldn't that be object typ but I'm glad that I kind of thought that and is where we got to do the Json build object and then in this case we have um numb games numb games then we have subject points subject points object points object points okay so I need to change these to subject points and object points I like that gives it a standard object points that gives us uh yeah that's everything so now this whole thing we can just say like insert into edges right and this should work this query takes like 10 seconds though because it's like we're finally actually having a query that's like big data or at least a little bit of Big Data okay Edge type as Edge type and that as Ed interesting so there is it's saying that there's a duplicate key in here where you have player player object cuz because we Group by that because it should be where they're different and then we have our player ID player name oh oh oh oh oh I bet okay I know what's going on here the problem here is that these player IDs or that these names are actually not uh so someone could have the same ID but a different name and that's that's causing issues so in this case this actually needs to be aggregated right so we just pick one of their names because they might like maybe he CH maybe like Dennis Rodman changed okay name to something else at some point and then yeah it's interesting I love how quickly he kind of is like okay yeah that's that's what's happening and um you got to take these out of the group by so that we only group on the identifiers and the edge type right that should now work so this query is going to be very powerful oh look at that it worked oh yeah oh yeah okay so now um now I just want to like kind of like we only have like a couple more minutes left in this lab but I'm going to show yall like what this actually did right so now like if we look at this like we have like um this is like the plays in Edge right but what we want to do is uh let's like put our vertices V join edges e right on v. identifier equals e do subject identifier and V do type equals e do subject type so um this uh and then what we can do here is we want to say where um e doob type equals player this query um Iden equals e do subject identifier and v. type equals e do subject type where e do object type \[Music\] equals yeah should give us there we go so now we have our um our properties and then see this gives us our number of games right so one of the things that we can do with this though right is this is going to be pretty cool I think this is going to blow y'all's mind a little bit so let's go ahead and get v. properties uh player name you'll see in here we have v. properties and then in this case we can say player name which is what we probably want that's the main thing but then we also want v. properties and then in this case we have um there's like number of games and total points right so in this case we're going to put number of games and uh going to cast this cast as um is it going to be as real it's going to cast this as real and then we're going to cast the total points as real as well so or we can yeah we can cast oh wait this is yeah we need another one like that then a division here right what why is it mad that unresolved symbol V doesn't it isn't that the cast cast oh no it's cuz there there we go that's why okay um so now like I just want to show what this is doing real quick because this is just going to give us oh yeah we get the division by zero right case when uh equals zero then one else got to just add a little block so that we get the actual that's fine you just talk so fast meas equals on and um this gives us like points per game right so you see this is actually going to give us our uh points per game uh number this is their career points per game but the thing is is we also have um in our e do properties right we have subject points and uh this is going to give us uh um and then we also have numb games right so we have eproperties and we have numb games and this will give us just kind of just show you what what this does right so now we and oh yeah we have one we have to get the last last one in here we have EOP properties in this case we have uh um object name right or what what did I end up calling it oh I didn't even it's oh it's object identifier that's what it is just it's easier e doob identifier and then okay so this will give us like an idea right so what happens here is this is going to be uh when this player on average when this player plays against this player this is is their career average right but this is actually the um the total number of points that they have right uh divided by games right so you can get the get that Division and you can see like oh this player actually is he's playing better than average or worse than average right you can kind of see like oh like who when he plays with these people or against these people like what is the better kind of approach right you can get all sorts of comparisons of like Global averages versus like playing with this person's average and you can kind of like build out like all sorts of different things like oh how does Michael Jordan play with Scotti Pippen or like all sorts of different kind of connections with all these different Edge types right so you can do all sorts of really power you see this but you see how this query though in comparison to the last query you see this query is instant right because we aggregated all like the big data and so like it's a lot better it's a lot lot better like um now that like it's actually aggregated up right and so uh that's another thing that you know y'all can check out but that's that's essentially where I wanted to you know end the lab today is at that point just to kind of show y'all how all of these kind of subjects and objects and vertices kind of come together and you can really do really powerful analyses quickly where you don't have to crunch that like Rowl data anymore you can actually Crunch at those higher level so that's pretty cool I quite like that um yeah I'm just do and uh no just going to aut by ascending to see what the kind of max value is um cool I will do some playing along with that tomorrow CU it's getting quite late now so it's bedtime but I quite like that um definitely want to unpack I'm interested to see if there's any like homework regarding this or any thing that I can do to create my own with my own like what I'd really like to be given is a um I'd love to be given like a a brief of this is what we need to create and then be told how to create it but I think that's that's you you're kind of getting into that kind of senior level there of like not being like told what to do um and that's just me being being being me but um I would really like that uh but I don't think that's what this course is going to be it's more you know I want you to do this thing this is the kind of structure I want you to do it in and go and do it but I'm I I much prefer having that kind of high level involvement um just because I think it helps me learn better but I still quite like the the I like La I I'll be interested if we do get any homework on this to do the homework um it was it was quite nice to follow as well like I like the I like the pattern um created with the like subject and the object uh identifiers and and types so I like that that's cool I'm going to end it here thank you for people who have stay to watch it's been great um chatting with you great great talking with you I'll see you next time


 > [!info]
> - **Graph Data Modeling Introduction (1:50-3:59):**  The lab focuses on building a graph data model in Postgres to analyze relationships between NBA players (who plays with whom and which teams they belong to). Docker, a cloned repo, and a SQL editor tool are required.
> - **Creating Vertices and Edges Tables (4:24-11:26):** Discusses creating `vertices` and `edges` tables with appropriate data types (ENUM for vertex and edge types, JSON for properties). The primary key for the `edges` table is a composite key of all columns except 'properties'.
> - **Populating Vertices Table with Game Data (13:18-19:38):** Demonstrates inserting game data into the `vertices` table, using `game_id` as the identifier and extracting properties like `points_home`, `points_away`, and `winning_team` using `JSON_BUILD_OBJECT`.
> - **Populating Vertices Table with Player Data (21:30-32:42):** Aggregates player data from `game_details` to create player vertices, including `player_id`, `player_name`, `number_of_games`, `total_points`, and `teams_played_on`. A CTE (Common Table Expression) is used for this aggregation.
> - **Addressing Duplicate Data (43:35-45:19):** Explains how to handle duplicate data in the `teams` table using `ROW_NUMBER()` and a CTE to select only distinct team records.
> - **Creating 'Plays In' Edges (50:54-55:59):** Shows how to insert data into the `edges` table to represent the 'plays in' relationship between players and games, extracting properties like `start_position`, `points`, `team_id`, and `team_abbreviation`.
> - **Analyzing Relationships with Graph Queries (1:00:00-1:04:34):** Demonstrates how to query the graph data to find the maximum points scored by each player in a game, highlighting the importance of casting JSON values to the correct data type (integer in this case) for accurate calculations.
> - **Creating 'Plays Against' and 'Shares Team' Edges (1:07:33-1:22:34):** Discusses creating edges for 'plays against' and 'shares team' relationships between players using a self-join on the `filtered` CTE.  Handles the creation of duplicate edges by comparing player names and filtering to include only one edge for each pair.
> - **Aggregating Edge Data (1:22:34-1:30:05):** Aggregates data for 'plays against' and 'shares team' edges, calculating the number of games played together and points scored by each player. Identifies and addresses a data quality issue where player IDs might have different names, requiring aggregation of names.
> - **Analyzing Player Performance (1:34:02-1:37:21):** Shows how to calculate points per game for players and analyze their performance against specific opponents, demonstrating the power of graph data modeling for complex relationship analysis.